window.NOIBUJS_CONFIG={"scriptID":"4fe68b115b5426cb43e98f20b717c1972a0bb0e1"};(()=>{var e={327:e=>{for(var t=[],n=0;n<256;++n)t[n]=(n+256).toString(16).substr(1);e.exports=function(e,n){var r=n||0,o=t;return[o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]]].join("")}},217:e=>{var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var n=new Uint8Array(16);e.exports=function(){return t(n),n}}else{var r=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}},171:(e,t,n)=>{var r=n(217),o=n(327);e.exports=function(e,t,n){var i=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||r)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[i+a]=s[a];return t||o(s)}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=["metroplexSocketBase","metroplexHTTPBase"],t=["innerText","textContent","title","value"],r=["Image","EventTarget","Window","Node","ApplicationCache","AudioTrackList","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"];function o(){return window.NOIBUJS_CONFIG?window.NOIBUJS_CONFIG:{}}const i=["i.noibu","i.staging.noibu","input.staging.noibu","input.b.noibu","input.noibu","vf.staging.noibu","vf.noibu"];function s(){const e=o();return e.scriptID?e.scriptID:"default"}function a(){try{const e="wss://input.noibu.com";return e.endsWith("/")?e.slice(0,-1):e}catch(e){return"ws://localhost:3000"}}function c(){try{const e="https://input.noibu.com";return e.endsWith("/")?e.slice(0,-1):e}catch(e){return"http://localhost:3000"}}function u(){return c()+"/pv"}function l(){try{return"prod"}catch(e){return"test"}}var d=n(171),p=n.n(d);const h=(e,t,n)=>{if(!(t in e))return;const r=e[t],o=n(r);if("function"==typeof o)try{o.prototype=o.prototype||{},Object.defineProperties(o,{__noibu__:{enumerable:!1,value:!0},__noibu_original__:{enumerable:!1,value:r},__noibu_wrapped__:{enumerable:!1,value:o}})}catch(e){}e[t]=o};function m(e){return e.split("\n").reduce((function(e,t){var n=function(e){var t=f.exec(e);if(!t)return null;var n=t[2]&&0===t[2].indexOf("native"),r=t[2]&&0===t[2].indexOf("eval"),o=v.exec(t[2]);r&&null!=o&&(t[2]=o[1],t[3]=o[2],t[4]=o[3]);return{file:n?null:t[2],methodName:t[1]||"<unknown>",arguments:n?[t[2]]:[],lineNumber:t[3]?+t[3]:null,column:t[4]?+t[4]:null}}(t)||function(e){var t=g.exec(e);if(!t)return null;return{file:t[2],methodName:t[1]||"<unknown>",arguments:[],lineNumber:+t[3],column:t[4]?+t[4]:null}}(t)||function(e){var t=y.exec(e);if(!t)return null;var n=t[3]&&t[3].indexOf(" > eval")>-1,r=b.exec(t[3]);n&&null!=r&&(t[3]=r[1],t[4]=r[2],t[5]=null);return{file:t[3],methodName:t[1]||"<unknown>",arguments:t[2]?t[2].split(","):[],lineNumber:t[4]?+t[4]:null,column:t[5]?+t[5]:null}}(t)||function(e){var t=S.exec(e);if(!t)return null;return{file:t[2],methodName:t[1]||"<unknown>",arguments:[],lineNumber:+t[3],column:t[4]?+t[4]:null}}(t)||function(e){var t=w.exec(e);if(!t)return null;return{file:t[3],methodName:t[1]||"<unknown>",arguments:[],lineNumber:+t[4],column:t[5]?+t[5]:null}}(t);return n&&e.push(n),e}),[])}var f=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|\/|[a-z]:\\|\\\\).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,v=/\((\S*)(?::(\d+))(?::(\d+))\)/;var g=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i;var y=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\[native).*?|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,b=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i;var w=/^\s*(?:([^@]*)(?:\((.*?)\))?@)?(\S.*?):(\d+)(?::(\d+))?\s*$/i;var S=/^\s*at (?:((?:\[object object\])?[^\\/]+(?: \[as \S+\])?) )?\(?(.*?):(\d+)(?::(\d+))?\)?\s*$/i;function C(e,t=1024){return e?e.length<t?e:e.substring(0,t):e}function k(){let e=window.location.href;return window.location.href.startsWith("http")?e=window.location.href:window.parent&&window.parent.location&&window.parent.location.href.startsWith("http")&&(e=window.parent.location.href),C(e)}function I(e){let t=[{line:"_",mname:"_",file:"_"}];if("object"!=typeof e||!e)return{frames:t,msg:""};e.stack?t=m(e.stack).map(e=>{const t={line:"_",mname:"_",file:"_"};return e.lineNumber&&"<unknown>"!==e.lineNumber&&(t.line=String(e.lineNumber)),e.methodName&&"<unknown>"!==e.methodName&&(t.mname=String(e.methodName)),e.file&&"<unknown>"!==e.file&&(t.file=String(e.file)),e.column&&"number"==typeof e.column&&(t.column=e.column),t}):(e.fileName&&"string"==typeof e.fileName&&(t[0].file=e.fileName),e.lineNumber&&(t[0].line=String(e.lineNumber)),e.columnNumber&&Number.isInteger(e.columnNumber)&&(t[0].column=e.columnNumber)),t.length>=50&&(t=t.slice(0,50));return{frames:t,msg:e.message?C(e.message):""}}function _(e){if(Array.prototype.toJSON){const t=Array.prototype.toJSON;delete Array.prototype.toJSON;const n=JSON.stringify(e);return Array.prototype.toJSON=t,n}return JSON.stringify(e)}function T(e,t,n,r,o,i){if(i){const e=_(n),t=new Blob([e]).size;return!window.fetch||t>59e3?new Promise(e=>{e()}):fetch(this.noibuErrorURL,{method:"POST",headers:r,body:_(n),keepalive:!0})}return new Promise((i,s)=>{const a=new XMLHttpRequest;a.open(e,t),a.timeout=o,Object.keys(r).forEach(e=>{a.setRequestHeader(e,r[e])}),a.onload=()=>{a.status>=200&&a.status<300?i(a.response):s(new Error("Custom Request failed: "+a.statusText))},a.onerror=()=>{s(new Error("Custom Request failed: "+a.statusText))},n?a.send(_(n)):a.send()})}function E(){const e=o();return e.sel&&Array.isArray(e.sel)}function x(){const e=o(),t=[".noibu-blocked",".creditCard"];return E()&&t.push(...e.sel),""+t.join(",")}function M(){const e="1"===window.navigator.doNotTrack,t=function(e){let t=e;return t||(t=window.navigator.userAgent),t=t.toLowerCase(),new RegExp("(bot|crawl(er)?|sp(i|y)der|search|worm|fetch|nutch|headless|baidu|teoma|yandex|woorankreview|pingdom|synthetic|dataprovider|qaautomation|morningscore|wappalyzer|foregenix|StatusCake|SpeedCurve|Outlook-iOS|bitdiscovery|testing|webflow|bingpreview|(r|R)igor|facebookexternalhit/\\d+\\.\\d+)","i").test(t)}(null);return e||t}function N(e){return e?"object"==typeof e?_(e):String(e):""}function D(){return window.performance&&window.performance.now?window.performance.now():Date.now()}function O(e){let t=C(window.location.href);return e&&""!==e.trim()&&"undefined"!==e&&(t=N(C(e))),t}const L={"input.noibu.com":!0,"input.staging.noibu.com":!0,"vf.noibu.com":!0,"vf.staging.noibu.com":!0,"cdn.noibu.com":!0};function R(e){return window&&window.localStorage&&navigator.cookieEnabled?window.localStorage.getItem(e):null}function P(e,t){if(!window||!window.localStorage)throw new Error("window or window.localStorage do not exist");if(!navigator.cookieEnabled)throw new Error("cookies disabled");return window.localStorage.setItem(e,t)}function F(e){window&&window.localStorage&&navigator.cookieEnabled&&window.localStorage.removeItem(e)}class A{constructor(){this.pageVisitId=p()(),this.isClientDisabled=null,this.browserId=null,this.pageVisitSeq=null,this.lastActiveTime=new Date,this._setupLocalStorageVars(),this.noibuErrorURL="",this.cltErrorPostCounter=0,this.maxSocketInactiveTime=2100}static configureInstance(e){this.instance||(this.instance=new A,this.instance.noibuErrorURL=e)}static getInstance(){if(!this.instance)throw new Error("ClientConfig was not configured");return this.instance}lockClient(e,t){const n=new Date;n.setMinutes(n.getMinutes()+e);const r=this._getClientState();r.DisabledStatus=!0,r.ClientUnlockTime=n,this._storeBrowserData(r),this.postNoibuErrorAndOptionallyDisableClient(t,!0,"warn")}lockClientUntilNextPage(e){this.postNoibuErrorAndOptionallyDisableClient(e,!0,"warn")}updateLastActiveTime(e){this.lastActiveTime=e;const t=this._getLsObject();t.LastActive=e,this._storeBrowserData(t)}getPageVisitSeq(){if(this._pageVisitSeqNeedsReset()){this.pageVisitSeq=0;const e=this._getLsObject();e.CurrentPageVisitCount=this.pageVisitSeq+1,e.LastActive=new Date,this._storeBrowserData(e)}return this.pageVisitSeq}_getLsObject(){const e=R("n_browser_data");if(!e)return this._generateAndStoreData();let t={};try{t=JSON.parse(e)}catch(e){return this._generateAndStoreData()}return null==t.BrowserId||null==t.DisabledStatus||null==t.CurrentPageVisitCount||null==t.LastActive?this._generateAndStoreData():t}_pageVisitSeqNeedsReset(){const e=this._getClientState(),t=new Date;return t.setMinutes(t.getMinutes()-45),new Date(e.LastActive)<t}_setupLocalStorageVars(){const e=this._getClientState();if(this._pageVisitSeqNeedsReset()&&(e.CurrentPageVisitCount=0),this.browserId=e.BrowserId,this.pageVisitSeq=e.CurrentPageVisitCount,this.isClientDisabled=e.DisabledStatus,this.isClientDisabled||(e.CurrentPageVisitCount+=1,e.LastActive=new Date),"integration_test"===l()&&(e.pvId=this.pageVisitId),e.CurrentPageVisitCount>=300){A.getInstance().postNoibuErrorAndOptionallyDisableClient("Hit max page visits, disabling client",!0,"error");const t=new Date;t.setMinutes(t.getMinutes()+45),e.ClientUnlockTime=t}null===this._storeBrowserData(e).BrowserId&&(A.getInstance().postNoibuErrorAndOptionallyDisableClient("Null browser in local storage, disabling client",!0,"error"),this.browserId=null)}_getClientState(){const e=this._getLsObject();return e.ClientUnlockTime&&new Date(e.ClientUnlockTime)<=new Date&&(e.ClientUnlockTime=null,e.DisabledStatus=!1,this._storeBrowserData(e)),e}_generateAndStoreData(){return this._storeBrowserData(this._generateNewBrowserData())}_generateNewBrowserData(){const e={DisabledStatus:!1,BrowserId:p()(),CurrentPageVisitCount:0,ClientUnlockTime:null,LastActive:new Date};return"integration_test"===l()&&(e.pvId=this.pageVisitId),e}_storeBrowserData(e){try{return P("n_browser_data",_(e)),e}catch(e){this.postNoibuErrorAndOptionallyDisableClient("Error writing browser data to local storage, disabling client: "+e.message,!0,"error");return{DisabledStatus:!0,BrowserId:null,CurrentPageVisitCount:0}}}postNoibuErrorAndOptionallyDisableClient(e,t,n,r=!1){if(this.isClientDisabled)return;t&&(this.isClientDisabled=!0);let o=`Noibu Browser ID(${this.browserId?this.browserId:""}), PV ID ${this.pageVisitId}, Script ID ${s()}, and User Agent ${window.navigator.userAgent} error: ${N(e)}`;if(this.cltErrorPostCounter>=50){const e=new Date;e.setMinutes(e.getMinutes()+10);const t=this._getClientState();t.DisabledStatus=!0,t.ClientUnlockTime=e,this._storeBrowserData(t),this.isClientDisabled=!0,o="Shutting collect off, we reached the maximum limit of collect errors sent."}const i={url:window.location.href,err_msg:o,sev:n},a={"content-type":"application/json"};r?fetch(this.noibuErrorURL,{method:"POST",headers:a,body:_(i),keepalive:!0}):T("POST",this.noibuErrorURL,i,a,2e3,!1).catch(()=>{}),"error"===n&&(this.cltErrorPostCounter+=1)}isInactive(){const e=new Date;return e.setSeconds(e.getSeconds()-this.maxSocketInactiveTime),this.lastActiveTime<e}}class V{constructor(){this.expectedVideoLength=0,this.expectedVfSeq=0,this.expectedPvPart=0,this.videoClicks=0,this.pvClicks=0,this.errCount=0,this.httpCount=0,this.didCutPv=!1,this.didCutVideo=!1,this.writeTimeout=null,this._setupListeners()}static getInstance(){return this.instance||(this.instance=new V),this.instance}addVideoFragData(e,t){this.expectedVfSeq=e,this.expectedVideoLength=t}setPvPart(e){this.expectedPvPart=e}addVideoClick(){this.videoClicks+=1}addPvClick(){this.pvClicks+=1}addError(){this.errCount+=1}addHttpEvent(){this.httpCount+=1}setDidCutVideo(){this.didCutVideo=!0}setDidCutPv(){this.didCutPv=!0}_setupListeners(){["unload","pagehide"].forEach(e=>window.addEventListener(e,()=>{this._postMetricsIfActive()}))}_postMetricsIfActive(){A.getInstance().isClientDisabled||A.getInstance().isInactive()||this.postMetrics()}postMetrics(){const e={br_id:A.getInstance().browserId,pv_id:A.getInstance().pageVisitId,cv:2,v:1,exp_vid_len:this.expectedVideoLength,exp_vf_seq:this.expectedVfSeq,exp_pc_seq:this.expectedPvPart,vid_clicks:this.videoClicks,pv_clicks:this.pvClicks,did_cut_pv:this.didCutPv,did_cut_vid:this.didCutVideo,exp_http:this.httpCount,exp_err:this.errCount,on_url:document.location.href};window.fetch&&window.fetch(c()+"/metrics",{method:"POST",headers:{"content-type":"application/json"},body:_(e),keepalive:!0})}}class ${constructor(){this.isLocalStorageSupported=this._testLocalStorageSupported(),this.latestPageVisitFrag=null,this.writeTimeout=null,this.flushedLocalStorage=!1,this.isLocalStorageSupported&&this._postPreviousPageVisit()}static getInstance(){return this.instance||(this.instance=new $),this.instance}checkAndStoreRetryQueue(e,t){const{type:n,payload:r}=e[e.length-1];if("p"!==n||!r.pvp)return;(r.pvp.events?r.pvp.events:[]).filter(e=>"userstep"===e.type&&"click"===e.userstep.type||"loc"===e.type).length>0&&this.writePageVisitsFromRetryQueue(e,t)}writePageVisitsFromRetryQueue(e,t){const n=[];for(let t=0;t<e.length;t+=1){const{type:r,payload:o}=e[t];if("p"===r){const e=o.pvp;n.push(e)}}this._writePageVisitFrags(n,t)}_writePageVisitFrags(e,t){const n=_({pageVisitFrags:e,pageVisitInfo:t,timestamp:new Date});if(!(n.length>5242880))try{P("n_stored_page_visit",n)}catch(e){F("n_stored_page_visit");const t=function(){if(!window||!window.localStorage||!window.localStorage.key)return 0;if(!navigator.cookieEnabled)return 0;let e=0;for(let t=0;t<window.localStorage.length;t+=1){const n=window.localStorage.key(t);if(n){const t=R(n);t&&(e+=t.length)}}return e}();A.getInstance().postNoibuErrorAndOptionallyDisableClient(`Error writing page visit to local storage: ${e}, UserAgent: ${navigator.userAgent},  json size: ${n.length}, LS size: ${t}, `,!1,"error")}}_getPostData(){const e=R("n_stored_page_visit");if(!e)return null;let t={};try{t=JSON.parse(e)}catch(t){return F("n_stored_page_visit"),A.getInstance().postNoibuErrorAndOptionallyDisableClient(`Error parsing page visit string '${e}': ${t}`,!1,"error"),null}if(t.timestamp){const e=new Date;if(e.setSeconds(e.getSeconds()-2100),e>=Date.parse(t.timestamp))return null}const n={pvi:t.pageVisitInfo,pvp:[],pvvf:[]};n.pvi.last=!0;for(let e=0;e<t.pageVisitFrags.length;e+=1)n.pvp.push(t.pageVisitFrags[e]);return n}_testLocalStorageSupported(){try{P("n_key","N".repeat(512))}catch(e){return!1}return F("n_key"),!0}_postPreviousPageVisit(){this._getPostPageVisitPromise().then(()=>{this._updateLocalStorageFlushed()}).catch(()=>{this._updateLocalStorageFlushed()})}_updateLocalStorageFlushed(){this.flushedLocalStorage=!0,F("n_stored_page_visit")}_getPostPageVisitPromise(){return new Promise((e,t)=>{const n=this._getPostData();if(!n)return void e();T("POST",u(),n,{"content-type":"application/json"},2e3,!0).then(()=>{e()}).catch(e=>{t(new Error("Page visit post request rejected due to: ",e))})})}}class j{constructor(e){const t=a();this.forceClosed=!1,this.socket=null,this.socketInstanceId=null,this.previousMessageType="",this.currentConnectionAttempts=0,this.connectionCount=0,this.sessionStartTime=D(),this.connectionPromise=null,this.pageVisitInfoSent=!1,this.connectionURL=t+"/pv_part",this.postURL=u(),this.messageSequenceNum=0,this.latestReceivedSeqNumber=-1,this.isRetryLoopDisabled=!1,this.retryMessageQueue=[],this.metroplexTypeLock={},this.initialURL=k(),this.initialReferingURL=window.document.referrer?C(window.document.referrer):"",this.sessionTimestamp=new Date,this.latestReceivedSeqNumStoredTime=new Date,this.instanceId=p()(),this.scriptInstanceId=e}static getInstance(e){return this.instance||(this.instance=new j(e),this.instance.start()),this.instance}start(){this.connectSocket().then(()=>{this._setupOffloadEvents()})}_addSeqNumToPayload(e){e.pvp?(e.pvp.seq_num=this.messageSequenceNum,this.messageSequenceNum+=1):e.pvvf&&(e.pvvf.seq_num=this.messageSequenceNum,this.messageSequenceNum+=1)}sendMessage(e,t){if(e in this.metroplexTypeLock||A.getInstance().isClientDisabled)return;const n=t;if(this._addSeqNumToPayload(n),this.retryMessageQueue.push({payload:n,type:e}),$.getInstance().checkAndStoreRetryQueue(this.retryMessageQueue,this.getPageInformation()),this.isConnected()&&this.pageVisitInfoSent&&this._sendSocketMessage(n),this.previousMessageType=e,"p"===e&&t.pvp){const e=t.pvp.events?t.pvp.events:[];this._updateLatestPvTimestamp(e)}}_updateLatestPvTimestamp(e){e.filter(e=>"userstep"===e.type).length>0&&A.getInstance().updateLastActiveTime(new Date)}isConnected(){return null!==this.socket&&1===this.socket.readyState}isConnecting(){return null!==this.socket&&0===this.socket.readyState}close(){this.forceClosed=!0,(this.isConnected()||this.isConnecting())&&this.socket.close(1e3)}handleConnect(e){this.isConnected()||this.isConnecting()||(this.currentConnectionAttempts+=1,this.socket=new WebSocket(this.connectionURL),this.socketInstanceId=p()(),this.socket.onerror=()=>{},this.socket.onclose=()=>{this.pageVisitInfoSent=!1,this.forceClosed||this.isConnecting()||(clearInterval(this.retryMetroplexInterval),this.currentConnectionAttempts>=function(){try{return 20}catch(e){return 2}}()?A.getInstance().lockClientUntilNextPage("Too many reconnection attempts, locking until next page"):this.connectionCount>=100?A.getInstance().lockClientUntilNextPage("Too many connections, locking until next page"):setTimeout(()=>{this.handleConnect(e)},this.currentConnectionAttempts**2*function(){try{return METROPLEX_CONSECUTIVE_CONNECTION_DELAY}catch(e){return 1e3}}()))},this.socket.onmessage=e=>{this._onSocketMessage(e)},this.socket.onopen=()=>{this._onSocketOpen(),e()})}connectSocket(){return this.isConnected()||this.isConnecting()||(this.connectionPromise=new Promise(e=>{this.handleConnect(e),window.addEventListener("visibilitychange",()=>{this.forceClosed||this.isConnected()||this.isConnecting()||this.handleConnect(e)})})),this.connectionPromise}addEndTimeToPayload(e){const t=Math.ceil(D()-this.sessionStartTime),n=new Date(this.sessionTimestamp.getTime()+t).toISOString();e.end_at=n}_onSocketOpen(){this.isConnected()&&!A.getInstance().isClientDisabled&&(this._sendSocketMessage(this.getPageInformation()),this.pageVisitInfoSent=!0,this.currentConnectionAttempts=0,this.previousMessageType="",this._sendUnconfirmedMessages(),this.setupRetryMechanism(),this.connectionCount+=1)}_onSocketMessage(e){switch(e.data){case"vid_block":this.metroplexTypeLock.v=!0,V.getInstance().setDidCutVideo();break;case"pv_block":this.metroplexTypeLock.p=!0,V.getInstance().setDidCutPv();break;case"full_block":A.getInstance().lockClient(1440,"Metroplex blocked script"),this.close();break;case"close_conn":this.close();break;case"ok":break;default:if(e.data.includes("seq_num")){const t=e.data.split("seq_num:");if(t.length<2){A.getInstance().postNoibuErrorAndOptionallyDisableClient("Invalid message received from metroplex while clearing retry queue "+e.data,!1,"error");break}const n=parseInt(t[1],10);n<=this.latestReceivedSeqNumber?this.isRetryLoopDisabled=!0:this.isRetryLoopDisabled=!1,this.latestReceivedSeqNumber=n,this._clearRetryQueue(n)}}}_messagePayloadHasLargerSeqNum(e,t,n){return e.payload[t]&&e.payload[t].seq_num&&e.payload[t].seq_num>n}_clearRetryQueue(e){this.latestReceivedSeqNumStoredTime=new Date,this.retryMessageQueue=this.retryMessageQueue.filter(t=>this._messagePayloadHasLargerSeqNum(t,"pvp",e)||this._messagePayloadHasLargerSeqNum(t,"pvvf",e))}_sendUnconfirmedMessages(){if(!this.isConnected()||A.getInstance().isClientDisabled||this.isConnecting())return;const e=new Date;if(e.setSeconds(e.getSeconds()-3e4),!(e>=this.latestReceivedSeqNumStoredTime||this.isRetryLoopDisabled)){this.retryMessageQueue=this.retryMessageQueue.filter(e=>!(e.type in this.metroplexTypeLock));for(let e=0;e<this.retryMessageQueue.length;e+=1){const{type:t,payload:n}=this.retryMessageQueue[e];if(!this._sendSocketMessage(n))break;this.previousMessageType=t}}}setupRetryMechanism(){this.retryMetroplexInterval=setInterval(()=>{this._sendUnconfirmedMessages()},3e4)}_setupOffloadEvents(){window.addEventListener("unload",()=>{this._handleUnload()})}_handleUnload(){this.close(),A.getInstance().isClientDisabled||A.getInstance().isInactive()||this.postFullPageVisit()}postFullPageVisit(){if(0===this.retryMessageQueue.length)return;let e=0,t={pvi:this.getPageInformation(),pvp:[],pvvf:[],vpnum:this.connectionCount};t.pvi.last=!0,this.retryMessageQueue.forEach(n=>{let{type:r,payload:o}=n;const i=new Blob([_(o)]).size;if(!(e>59e3))switch(e+=i,e>=59e3&&(this.postMessage(t),t={pvi:this.getPageInformation(),pvp:[],pvvf:[],vpnum:t.vpnum},t.pvi.last=!0,e=0),r){case"v":t.pvvf.push(o.pvvf);break;case"p":t.pvp.push(o.pvp)}}),this.postMessage(t)}postMessage(e){const t=e;t.vpnum+=1,"test"===l()?navigator.sendBeacon(this.postURL,_(t)):window.fetch&&fetch(this.postURL,{method:"POST",headers:{"content-type":"application/json"},body:_(t),keepalive:!0})}_sendSocketMessage(e){return!this.closeIfInactive()&&(this.socket.send(_(e)),!0)}closeIfInactive(){const e=A.getInstance().isInactive();return e&&!A.getInstance().isClientDisabled&&(A.getInstance().lockClientUntilNextPage("Session is inactive, locking until next page"),this.close(),V.getInstance().postMetrics(),this.postFullPageVisit()),e}getPageInformation(){const e={br_id:A.getInstance().browserId,pv_id:A.getInstance().pageVisitId,v:5,seq:A.getInstance().getPageVisitSeq(),on_url:this.initialURL,ref_url:this.initialReferingURL,start_at:this.sessionTimestamp.toISOString(),conc:this.connectionCount,cv:2,last:!1,script_id:s(),script_inst_id:this.scriptInstanceId,mp_sock_inst_id:this.instanceId,sock_inst_id:this.socketInstanceId},t=function(){const e=window.navigator.userLanguage||window.navigator.language;return""!==e&&e?e.toLowerCase():null}();return t&&(e.lang=t),e}}class q{constructor(){this.partCounter=0,this.pvMap={},this.partCounter=0,this.pvEventLength=0,this.visibilityChangedCounter=0,this.totalPvEventLength=0,this.inDebounceHandle=0,this.isInAcceleratedPvPostMode=!1}static configureInstance(){this.instance||(this.instance=new q)}static getInstance(){if(!this.instance)throw new Error("Pagevisit was never configured");return this.instance}addPageVisitEvents(e,t){e.forEach(e=>{this._addPageVisitEvent(e,t)}),this._sendPageVisitMessage()}addPageVisitEvent(e,t){const n=this._addPageVisitEvent(e,t);return this._sendPageVisitMessage(),n}_addPageVisitEvent(e,t){if(!("occurredAt"in e)||!("event"in e))throw new Error("missing attributes in the eventObj");const n={type:t,occ_at:e.occurredAt,[t]:e.event};this.pvEventLength>=200&&this._sendPageVisitMessage();const r=p()();return this.pvMap[r]=n,this.pvEventLength+=1,this.totalPvEventLength+=1,r}static makePageVisitFrag(e,t){const n={};return n.events=e,n.pc=t,j.getInstance().addEndTimeToPayload(n),n}_sendPageVisitMessage(){const e=Object.keys(this.pvMap).map(e=>this.pvMap[e]);if(0===e.length)return;if(this.partCounter>=1e4)return void A.getInstance().lockClientUntilNextPage(`NoibuJS will stop processing parts because we reached max parts: 10000. Variables: \n      total Pv Event Length: ${this.totalPvEventLength}\n      visibility Changed Counter: ${this.visibilityChangedCounter}\n      `);const t=q.makePageVisitFrag(e,this.partCounter);V.getInstance().setPvPart(this.partCounter);const n={pvp:t};j.getInstance().sendMessage("p",n),this.pvMap={},this.pvEventLength=0,this.partCounter+=1}}class z{constructor(){this.eventsToDebounce={},this.registerInputType("loc",0),this.registerInputType("err",500),this.registerInputType("http",500),this.registerInputType("kbd",500,"userstep"),this._setupUnloadHandler()}static getInstance(){return this.instance||(this.instance=new z),this.instance}registerInputType(e,t,n=e){e in this.eventsToDebounce||(this.eventsToDebounce[e]={timeout:null,events:[],debouncePeriod:t,eventName:n})}addEvent(e,t){if(!(t in this.eventsToDebounce))throw new Error(`Type: ${t} is not in eventsToDebounce`);this.eventsToDebounce[t].events.push({event:e,occurredAt:(new Date).toISOString()}),this._debouncePvEvents(t)}_debouncePvEvents(e){clearTimeout(this.eventsToDebounce[e].timeout),this.eventsToDebounce[e].timeout=setTimeout(()=>{this.eventsToDebounce[e].timeout=null,q.getInstance().addPageVisitEvents(this.eventsToDebounce[e].events,this.eventsToDebounce[e].eventName),this.eventsToDebounce[e].events=[]},this.eventsToDebounce[e].debouncePeriod)}_setupUnloadHandler(){window.addEventListener("unload",()=>{Object.values(this.eventsToDebounce).forEach(e=>{q.getInstance().addPageVisitEvents(e.events,e.eventName)})})}}function U(e){return{url:O(e.filename),type:"js",j_err:I(e.error)}}function B(e,t){let n=t;switch(t.error&&t.error.originalError&&(n=t.error.originalError),e){case"XMLHttpRequest":return function(e){return{url:O(e.responseURL),type:"http",h_code:e.status}}(n);case"ErrorEvent":return U(n);case"Event":return function(e){return{url:O(e.target.src),type:"events"}}(n);case"Response":return function(e){return{url:O(e.url),type:"http",h_code:e.status}}(n);case"WrappedException":return U(n);case"FetchException":return function(e){return{url:O(e.url),type:"js",j_err:I({message:"Could not use the fetch API: "+N(e.str)})}}(n);default:try{return U(n)}catch(e){return null}}}function H(e,t){const n=B(e,t);if(!n||!n.url||"events"===n.type)return;const r=n.url;if(function(e){try{return URL(e),!0}catch(e){return!1}}(r)){const e=new URL(r);if(e.hostname in L||!e.protocol.startsWith("http"))return}(function(e){if("js"===e.type){if(e.j_err){const t=e.j_err.frames;if(t&&t.length>0){const n=t[0].file.toLowerCase(),r=t[0].mname.toLowerCase();if(n.includes("noibu")&&!r.includes("nbuwrapper"))return A.getInstance().postNoibuErrorAndOptionallyDisableClient(e,!1,"error"),!0}}else if(e.msg){if(e.msg.toLowerCase().includes("noibu"))return A.getInstance().postNoibuErrorAndOptionallyDisableClient(e,!1,"error"),!0}}else if("http"===e.type&&e.url){const t=e.url;if("string"==typeof t)for(let n=0;n<i.length;n+=1){const r=i[n];if(t.includes(r))return A.getInstance().postNoibuErrorAndOptionallyDisableClient(e,!1,"error"),!0}}return!1})(n)||(V.getInstance().addError(),z.getInstance().addEvent(n,"err"))}let W=0;function X(e){if("function"!=typeof e)return e;try{if(e.__noibu__)return e;if(e.__noibu_wrapped__)return e.__noibu_wrapped__}catch(t){return e}const nbuWrapper=function(...t){try{const n=Array.prototype.slice.call(t).map(e=>X(e));return e.handleEvent?e.handleEvent.apply(this,n):e.apply(this,n)}catch(e){throw H("WrappedException",{error:e}),W+=1,setTimeout(()=>{W-=1}),e}};try{for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(nbuWrapper[t]=e[t])}catch(e){}nbuWrapper.prototype=e.prototype||{},Object.defineProperty(e,"__noibu_wrapped__",{enumerable:!1,value:nbuWrapper}),Object.defineProperties(nbuWrapper,{__noibu__:{enumerable:!1,value:!0},__noibu_original__:{enumerable:!1,value:e}});try{Object.getOwnPropertyDescriptor(nbuWrapper,"name").configurable&&Object.defineProperty(nbuWrapper,"name",{get:()=>e.name})}catch(t){return e}return nbuWrapper}function Q(e){e&&e.constructor&&e.constructor.name&&"undefined"!==e.constructor.name&&!(W>0)&&H(e.constructor.name,e)}function J(){r.forEach(e=>{const t=window[e],n=t&&t.prototype;n&&n.hasOwnProperty&&n.hasOwnProperty("addEventListener")&&(h(n,"addEventListener",(function(e){return function(t,n,r){if(!n)return e.call(this,t,n,r);let o;if(n.handleEvent){const e=X(n.handleEvent.bind(n));o=n,o.handleEvent=e}else o=X(n);return e.call(this,t,o,r)}})),h(n,"removeEventListener",(function(e){return function(t,n,r){let o=n;try{o=o&&(o.__noibu_wrapped__||o)}catch(e){}return e.call(this,t,o,r)}})))}),window.addEventListener("error",Q,!0)}class G{constructor(e){const t=e;(!t.resp_time||t.resp_time<0)&&(t.resp_time=0),t.mtd=e.mtd.toUpperCase(),t.url=C(N(t.url)),this.httpEvent=t}saveHTTPEvent(){this.httpEvent&&this.httpEvent.url&&""!==this.httpEvent.url.trim()&&(V.getInstance().addHttpEvent(),z.getInstance().addEvent(this.httpEvent,"http"))}}function Y(e){return"number"!=typeof e||(e>=400||e<=0)}function K(){const e=window.XMLHttpRequest,t=e&&e.prototype;if(!t||!t.hasOwnProperty||!t.hasOwnProperty("open"))return;const n=Object.getOwnPropertyDescriptor(t,"open");if(!n.writable){if(!n.configurable)return void function(e){const t=Object.getOwnPropertyDescriptor(e,"send");if(!t.writable){if(!t.configurable)return;Object.defineProperty(e,"send",{writable:!0})}h(e,"send",(function(e){return function(t){const n=t?"POST":"GET",r=new Date;return this.addEventListener("loadend",()=>{const e=new Date,t=Math.abs(e-r),o={mtd:n,code:this.status,url:this.responseURL,r_time:t};let i=new G(o);i.saveHTTPEvent(),i=null,Y(this.status)&&H("XMLHttpRequest",this)}),e.call(this,t)}}))}(t);Object.defineProperty(t,"open",{writable:!0})}!function(e){h(e,"open",(function(e){return function(t,n,r=!0,o=null,i=null){const s=new Date;return this.addEventListener("loadend",()=>{const e=new Date,r=Math.abs(e-s),o={mtd:t,code:this.status,url:n,r_time:r};let i=new G(o);i.saveHTTPEvent(),i=null,Y(this.status)&&H("XMLHttpRequest",this)}),e.call(this,t,n,r,o,i)}}))}(t)}function Z(){K(),function(){const e=window;e&&e.hasOwnProperty&&e.hasOwnProperty("fetch")&&h(e,"fetch",(function(e){return function(t,n){const r=e.call(this,t,n),o=n&&n.method?n.method:"GET",i=new Date;return r.then(e=>{const n=new Date,r=Math.abs(n-i),s={mtd:o,code:e.status,url:t,r_time:r};let a=new G(s);a.saveHTTPEvent(),a=null,Y(e.status)&&H("Response",e)}).catch(e=>{H("FetchException",{url:t.url?t.url:window.location.href,str:e})}),r}}))}()}function ee(e){const t=e;return t.class=N(t.class),t}const te=["\\b(view|add|my)\\b.*\\b(cart|bag|basket|bucket|box)\\b","\\b(buy now)\\b","^backorder$","\\b(acquista ora)\\b","\\b(buy this)\\b","\\b(ajouter|mon)\\b.*\\b(panier)\\b","\\b(aggiungi)\\b.*\\b(cart|borsa|carrello)\\b","^ajouter à la shopping bag$","^aggiungi$","^aggiungi alla shopping bag$","\\b(warenkorb)\\b","(^kaufen$)","^купить$","\\b(agregar)\\b.*\\b(carrito)\\b","\\b(adicionar)\\b.*\\b(carrinho)\\b","^carrinho$","^añadir al carrito de compras$","(^añadir al carrito$)","(add another)","(in winkelmand)","(sepete ekle)","(Lagg I Varukorgen)","(ΠΡΟΣΘΗΚΗ ΣΤΟ ΚΑΛΑΘΙ)","(Lägg i varukorgen)","(Köp)","(カートに追加)","^添加至购物袋$","^购买$","^購入する$","(أضف الى السلة)"],ne=["(paypal)","(checkout|payment|check out)","(l.?achat|règlement|paiement|la commande)","(passer).*(commande)","valider mon panier","(acheter maintenant)","^caisse$","(gå vidare till kassan)","(cassa|acquisto)","^vai alla cassa$","^procedi all.?acquisto$","^procedi al checkout$","^siguiente$","(kasse)","^zur kasse gehen$","^bezahlen$","^weiter zum checkout$","(comprar ahora)","^comprar$","(prosseguir com a compra)","^pasar por la caja$","^afrekenen$","^compre$","(continue to pay)","(naar de kassa)","Перейти к оформлению заказа","^купить сейчас$","^bestellen$","(Alışverişi Tamamla)","^Till kassan$","(チェックアウトに進む)","^去结算$","^付款。$","^お支払い$","(تاكيد الطلب)"],re=["(checkout|continue) (with paypal)","^continue to paypal$","^weiter zu paypal$","^continue to afterpay$","^braintree_paypal$","^pay and place order$","^mit paypal bezahlen$","^continue to payment securely$","(continua su paypal)","(apple pay|applepay)","(amazon pay|amazonpay|continue with amazon)","(sezzlepay)","(place order)","(place your order)","(order confirmation)","(complete purchase)","submit.*order","(pay now)","(^pay it now$)","(make payment)","(^make payment$)","(complete order)","^complete your order$","(fazer pedido)","^encomendar$","((realizar) (pedido|pago))","^finalizar compra$","^pagar$","^jetzt kaufen$","^bestellung aufgeben$","^bestellung prüfen$","^auftragsbestätigung$","^bestelling plaatsen$","^passer la commande$","(je confirme et je paye)","(accéder au paiement)","^passer au paiement$","(Valider et continuer)","^valider la commande$","(^passez la commande$)","^invia ordine$","(effettua ordine)","^effettua l.?ordine$","(conferma acquisto)","^conferma l.?acquisto$","^confirmation de commande$","^confirma l.?ordine$","^conferma l.?ordine$","^conferma ordine$","(SİPARİŞİ TAMAMLA)","^Разместить заказ$","(Slutför köp)","(注文する)","(إنشاء الطلب)","(注文を確定)","^お支払いへ進む$","^确认下单$"];class oe{constructor(){this.textCapturedWhiteListRegex=new RegExp(te.concat(ne).concat(re).join("|"),"i"),this.htmlIDWhiteListRegex=new RegExp("method|finance|sagepay|cart|bag|coupon|affirm|karna|sezzle","i")}static getInstance(){return this.instance||(this.instance=new oe),this.instance}monitorClicks(){window.addEventListener("click",this._onClickHandle.bind(this),!0)}_onClickHandle(e){const t=function(){const e=o(),t=["noibu-blocked"];return E()&&e.sel.forEach(e=>{e.startsWith(".")&&e.length>0&&t.push(e.substring(1))}),t}();if(e.srcElement){const n=e.srcElement;let r=this._getTextualContentFromEl(n,!0);"IMG"===n.tagName&&(r=n.alt?n.alt:"");const o=n.className?n.className:"";let i=r.replace(/(\r\n|\n|\r|\\n)/gm,"").trim(),s="";n.tagName&&(s=n.tagName.toLowerCase());let a=n.id?n.id:"";if("string"!=typeof a&&(a=""),!this.textCapturedWhiteListRegex.test(i)&&!this.htmlIDWhiteListRegex.test(a)){"input"===s?n.type&&"button"===n.type||(i="*"):"textarea"!==s&&"select"!==s||(i="*");i=t.filter(e=>e===o).length>0?"*":i}i=function(e){return e.replace(/[0-9]/g,"*")}(i);const c={src:n.src?n.src:"",txt:i,tag:s,hid:a,type:"click",class:o};V.getInstance().addPvClick(),q.getInstance().addPageVisitEvents([{event:ee(c),occurredAt:(new Date).toISOString()}],"userstep")}}_parseTextFromParentElement(e){let t=e;const n=[];let r=0;for(;t&&!(r>=5);)n.push(t),t=t.parentNode,r+=1;for(let e=0;e<n.length;e+=1){const t=n[e];if("BUTTON"===t.tagName)return this._getTextualContentFromEl(t,!1)}return""}_getTextualContentFromEl(e,n){let r="";for(let n=0;n<t.length;n+=1){const o=t[n];if(e[o]&&""!==e[o].trim()){r=e[o];break}}return""===r&&n&&(r=this._parseTextFromParentElement(e)),r.length>100&&(r=r.substring(0,97)+"..."),r}}class ie{constructor(){this.inputsTracked={}}monitor(){this._attachListenersToInputTags("input","textarea"),this._listenForNewInputTags("input","textarea")}_listenForNewInputTags(...e){new MutationObserver(t=>{t.forEach(t=>{for(let n=0;n<t.addedNodes.length;n+=1)if("FORM"===t.addedNodes[n].tagName){const e=t.addedNodes[n].getElementsByTagName("input");Array.prototype.slice.call(e).forEach(e=>{this._attachListenerToTextInput(e)})}else e.forEach(e=>{t.addedNodes[n].tagName===e.toUpperCase()&&this._attachListenerToTextInput(t.addedNodes[n])})})}).observe(window.document,{subtree:!0,childList:!0})}_attachListenersToInputTags(...e){e.forEach(e=>{const t=window.document.getElementsByTagName(e);Array.prototype.slice.call(t).forEach(e=>{this._attachListenerToTextInput(e)})})}_attachListenerToTextInput(e){const t=e.placeholder||e.name||"";this.inputsTracked[t]||""===t||(this.inputsTracked[t]=!0,e.addEventListener("input",()=>{z.getInstance().addEvent(ee({src:"",txt:t,tag:e.tagName.toLowerCase(),hid:e.id,type:"kbd",class:e.className}),"kbd")}))}}let se=window.location.href;var ae,ce=function(){return(ce=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function ue(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function le(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function de(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(le(arguments[t]));return e}function pe(e){return e.nodeType===e.ELEMENT_NODE}function he(e){var t,n=null===(t=e)||void 0===t?void 0:t.host;return Boolean(n&&n.shadowRoot&&n.shadowRoot===e)}function me(e){var t=e.maskInputOptions,n=e.tagName,r=e.type,o=e.value,i=e.maskInputFn,s=o||"";return(t[n.toLowerCase()]||t[r])&&(s=i?i(s):"*".repeat(s.length)),s}!function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"}(ae||(ae={}));var fe=1,ve=RegExp("[^a-z0-9-_:]");function ge(e){try{var t=e.rules||e.cssRules;return t?Array.from(t).map(ye).join(""):null}catch(e){return null}}function ye(e){var t=e.cssText;if(function(e){return"styleSheet"in e}(e))try{t=ge(e.styleSheet)||t}catch(e){}return t}var be=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,we=/^(?!www\.|(?:http|ftp)s?:\/\/|[A-Za-z]:\\|\/\/|#).*/,Se=/^(data:)([^,]*),(.*)/i;function Ce(e,t){return(e||"").replace(be,(function(e,n,r,o,i,s){var a,c=r||i||s,u=n||o||"";if(!c)return e;if(!we.test(c))return"url("+u+c+u+")";if(Se.test(c))return"url("+u+c+u+")";if("/"===c[0])return"url("+u+(((a=t).indexOf("//")>-1?a.split("/").slice(0,3).join("/"):a.split("/")[0]).split("?")[0]+c)+u+")";var l=t.split("/"),d=c.split("/");l.pop();for(var p=0,h=d;p<h.length;p++){var m=h[p];"."!==m&&(".."===m?l.pop():l.push(m))}return"url("+u+l.join("/")+u+")"}))}var ke=/^[^ \t\n\r\u000c]+/,Ie=/^[, \t\n\r\u000c]+/;function _e(e,t){if(!t||""===t.trim())return t;var n=e.createElement("a");return n.href=t,n.href}function Te(){var e=document.createElement("a");return e.href="",e.href}function Ee(e,t,n,r){return"src"===n||"href"===n&&r||"xlink:href"===n&&r&&"#"!==r[0]?_e(e,r):"background"!==n||!r||"table"!==t&&"td"!==t&&"th"!==t?"srcset"===n&&r?function(e,t){if(""===t.trim())return t;var n=0;function r(e){var r,o=e.exec(t.substring(n));return o?(r=o[0],n+=r.length,r):""}for(var o=[];r(Ie),!(n>=t.length);){var i=r(ke);if(","===i.slice(-1))i=_e(e,i.substring(0,i.length-1)),o.push(i);else{var s="";i=_e(e,i);for(var a=!1;;){var c=t.charAt(n);if(""===c){o.push((i+s).trim());break}if(a)")"===c&&(a=!1);else{if(","===c){n+=1,o.push((i+s).trim());break}"("===c&&(a=!0)}s+=c,n+=1}}}return o.join(", ")}(e,r):"style"===n&&r?Ce(r,Te()):r:_e(e,r)}function xe(e,t,n){if(!e)return!1;if(e.nodeType===e.ELEMENT_NODE){if("string"==typeof t){if(e.classList.contains(t))return!0}else e.classList.forEach((function(e){if(t.test(e))return!0}));return!(!n||!e.matches(n))||xe(e.parentNode,t,n)}return e.nodeType,e.TEXT_NODE,xe(e.parentNode,t,n)}function Me(e,t){var n,r,o,i,s=t.doc,a=t.blockClass,c=t.blockSelector,u=t.maskTextClass,l=t.maskTextSelector,d=t.inlineStylesheet,p=t.maskInputOptions,h=void 0===p?{}:p,m=t.maskTextFn,f=t.maskInputFn,v=t.recordCanvas,g=t.keepIframeSrcFn;if(s.__sn){var y=s.__sn.id;r=1===y?void 0:y}switch(e.nodeType){case e.DOCUMENT_NODE:return"CSS1Compat"!==e.compatMode?{type:ae.Document,childNodes:[],compatMode:e.compatMode,rootId:r}:{type:ae.Document,childNodes:[],rootId:r};case e.DOCUMENT_TYPE_NODE:return{type:ae.DocumentType,name:e.name,publicId:e.publicId,systemId:e.systemId,rootId:r};case e.ELEMENT_NODE:for(var b=function(e,t,n){if("string"==typeof t){if(e.classList.contains(t))return!0}else for(var r=0;r<e.classList.length;r++){var o=e.classList[r];if(t.test(o))return!0}return!!n&&e.matches(n)}(e,a,c),w=function(e){if(e instanceof HTMLFormElement)return"form";var t=e.tagName.toLowerCase().trim();return ve.test(t)?"div":t}(e),S={},C=0,k=Array.from(e.attributes);C<k.length;C++){var I=k[C],_=I.name,T=I.value;S[_]=Ee(s,w,_,T)}if("link"===w&&d){var E,x=Array.from(s.styleSheets).find((function(t){return t.href===e.href}));(E=ge(x))&&(delete S.rel,delete S.href,S._cssText=Ce(E,x.href))}if("style"===w&&e.sheet&&!(e.innerText||e.textContent||"").trim().length)(E=ge(e.sheet))&&(S._cssText=Ce(E,Te()));if("input"===w||"textarea"===w||"select"===w){T=e.value;"radio"!==S.type&&"checkbox"!==S.type&&"submit"!==S.type&&"button"!==S.type&&T?S.value=me({type:S.type,tagName:w,value:T,maskInputOptions:h,maskInputFn:f}):e.checked&&(S.checked=e.checked)}if("option"===w&&(e.selected?S.selected=!0:delete S.selected),"canvas"===w&&v&&(S.rr_dataURL=e.toDataURL()),"audio"!==w&&"video"!==w||(S.rr_mediaState=e.paused?"paused":"played",S.rr_mediaCurrentTime=e.currentTime),e.scrollLeft&&(S.rr_scrollLeft=e.scrollLeft),e.scrollTop&&(S.rr_scrollTop=e.scrollTop),b){var M=e.getBoundingClientRect(),N=M.width,D=M.height;S={class:S.class,rr_width:N+"px",rr_height:D+"px"}}return"iframe"!==w||g(S.src)||(e.contentDocument||(S.rr_src=S.src),delete S.src),{type:ae.Element,tagName:w,attributes:S,childNodes:[],isSVG:(i=e,"svg"===i.tagName||i instanceof SVGElement||void 0),needBlock:b,rootId:r};case e.TEXT_NODE:var O=e.parentNode&&e.parentNode.tagName,L=e.textContent,R="STYLE"===O||void 0,P="SCRIPT"===O||void 0;if(R&&L){try{(null===(n=e.parentNode.sheet)||void 0===n?void 0:n.cssRules)&&(L=(o=e.parentNode.sheet).cssRules?Array.from(o.cssRules).map((function(e){return e.cssText||""})).join(""):"")}catch(e){}L=Ce(L,Te())}return P&&(L="SCRIPT_PLACEHOLDER"),!R&&!P&&xe(e,u,l)&&L&&(L=m?m(L):L.replace(/[\S]/g,"*")),{type:ae.Text,textContent:L||"",isStyle:R,rootId:r};case e.CDATA_SECTION_NODE:return{type:ae.CDATA,textContent:"",rootId:r};case e.COMMENT_NODE:return{type:ae.Comment,textContent:e.textContent||"",rootId:r};default:return!1}}function Ne(e){return void 0===e?"":e.toLowerCase()}function De(e,t){var n,r=t.doc,o=t.map,i=t.blockClass,s=t.blockSelector,a=t.maskTextClass,c=t.maskTextSelector,u=t.skipChild,l=void 0!==u&&u,d=t.inlineStylesheet,p=void 0===d||d,h=t.maskInputOptions,m=void 0===h?{}:h,f=t.maskTextFn,v=t.maskInputFn,g=t.slimDOMOptions,y=t.recordCanvas,b=void 0!==y&&y,w=t.onSerialize,S=t.onIframeLoad,C=t.iframeLoadTimeout,k=void 0===C?5e3:C,I=t.keepIframeSrcFn,_=void 0===I?function(){return!1}:I,T=t.preserveWhiteSpace,E=void 0===T||T,x=Me(e,{doc:r,blockClass:i,blockSelector:s,maskTextClass:a,maskTextSelector:c,inlineStylesheet:p,maskInputOptions:m,maskTextFn:f,maskInputFn:v,recordCanvas:b,keepIframeSrcFn:_});if(!x)return console.warn(e,"not serialized"),null;n="__sn"in e?e.__sn.id:!function(e,t){if(t.comment&&e.type===ae.Comment)return!0;if(e.type===ae.Element){if(t.script&&("script"===e.tagName||"link"===e.tagName&&"preload"===e.attributes.rel&&"script"===e.attributes.as||"link"===e.tagName&&"prefetch"===e.attributes.rel&&"string"==typeof e.attributes.href&&e.attributes.href.endsWith(".js")))return!0;if(t.headFavicon&&("link"===e.tagName&&"shortcut icon"===e.attributes.rel||"meta"===e.tagName&&(Ne(e.attributes.name).match(/^msapplication-tile(image|color)$/)||"application-name"===Ne(e.attributes.name)||"icon"===Ne(e.attributes.rel)||"apple-touch-icon"===Ne(e.attributes.rel)||"shortcut icon"===Ne(e.attributes.rel))))return!0;if("meta"===e.tagName){if(t.headMetaDescKeywords&&Ne(e.attributes.name).match(/^description|keywords$/))return!0;if(t.headMetaSocial&&(Ne(e.attributes.property).match(/^(og|twitter|fb):/)||Ne(e.attributes.name).match(/^(og|twitter):/)||"pinterest"===Ne(e.attributes.name)))return!0;if(t.headMetaRobots&&("robots"===Ne(e.attributes.name)||"googlebot"===Ne(e.attributes.name)||"bingbot"===Ne(e.attributes.name)))return!0;if(t.headMetaHttpEquiv&&void 0!==e.attributes["http-equiv"])return!0;if(t.headMetaAuthorship&&("author"===Ne(e.attributes.name)||"generator"===Ne(e.attributes.name)||"framework"===Ne(e.attributes.name)||"publisher"===Ne(e.attributes.name)||"progid"===Ne(e.attributes.name)||Ne(e.attributes.property).match(/^article:/)||Ne(e.attributes.property).match(/^product:/)))return!0;if(t.headMetaVerification&&("google-site-verification"===Ne(e.attributes.name)||"yandex-verification"===Ne(e.attributes.name)||"csrf-token"===Ne(e.attributes.name)||"p:domain_verify"===Ne(e.attributes.name)||"verify-v1"===Ne(e.attributes.name)||"verification"===Ne(e.attributes.name)||"shopify-checkout-api-token"===Ne(e.attributes.name)))return!0}}return!1}(x,g)&&(E||x.type!==ae.Text||x.isStyle||x.textContent.replace(/^\s+|\s+$/gm,"").length)?fe++:-2;var M=Object.assign(x,{id:n});if(!Object.isExtensible(e))return null;if(e.__sn=M,-2===n)return null;o[n]=e,w&&w(e);var N=!l;if(M.type===ae.Element&&(N=N&&!M.needBlock,delete M.needBlock),(M.type===ae.Document||M.type===ae.Element)&&N){g.headWhitespace&&x.type===ae.Element&&"head"===x.tagName&&(E=!1);for(var D={doc:r,map:o,blockClass:i,blockSelector:s,maskTextClass:a,maskTextSelector:c,skipChild:l,inlineStylesheet:p,maskInputOptions:m,maskTextFn:f,maskInputFn:v,slimDOMOptions:g,recordCanvas:b,preserveWhiteSpace:E,onSerialize:w,onIframeLoad:S,iframeLoadTimeout:k,keepIframeSrcFn:_},O=0,L=Array.from(e.childNodes);O<L.length;O++){(F=De(L[O],D))&&M.childNodes.push(F)}if(pe(e)&&e.shadowRoot){M.isShadowHost=!0;for(var R=0,P=Array.from(e.shadowRoot.childNodes);R<P.length;R++){var F;(F=De(P[R],D))&&(F.isShadow=!0,M.childNodes.push(F))}}}return e.parentNode&&he(e.parentNode)&&(M.isShadow=!0),M.type===ae.Element&&"iframe"===M.tagName&&function(e,t,n){var r=e.contentWindow;if(r){var o,i=!1;try{o=r.document.readyState}catch(e){return}if("complete"===o){"about:blank"===r.location.href&&"about:blank"!==e.src&&""!==e.src?e.addEventListener("load",t):setTimeout(t,0)}else{var s=setTimeout((function(){i||(t(),i=!0)}),n);e.addEventListener("load",(function(){clearTimeout(s),i=!0,t()}))}}}(e,(function(){var t=e.contentDocument;if(t&&S){var n=De(t,{doc:t,map:o,blockClass:i,blockSelector:s,maskTextClass:a,maskTextSelector:c,skipChild:!1,inlineStylesheet:p,maskInputOptions:m,maskTextFn:f,maskInputFn:v,slimDOMOptions:g,recordCanvas:b,preserveWhiteSpace:E,onSerialize:w,onIframeLoad:S,iframeLoadTimeout:k,keepIframeSrcFn:_});n&&S(e,n)}}),k),M}var Oe,Le,Re,Pe,Fe,Ae=/([^\\]):hover/;new RegExp(Ae,"g");function Ve(e,t,n){void 0===n&&(n=document);var r={capture:!0,passive:!0};return n.addEventListener(e,t,r),function(){return n.removeEventListener(e,t,r)}}!function(e){e[e.DomContentLoaded=0]="DomContentLoaded",e[e.Load=1]="Load",e[e.FullSnapshot=2]="FullSnapshot",e[e.IncrementalSnapshot=3]="IncrementalSnapshot",e[e.Meta=4]="Meta",e[e.Custom=5]="Custom",e[e.Plugin=6]="Plugin"}(Oe||(Oe={})),function(e){e[e.Mutation=0]="Mutation",e[e.MouseMove=1]="MouseMove",e[e.MouseInteraction=2]="MouseInteraction",e[e.Scroll=3]="Scroll",e[e.ViewportResize=4]="ViewportResize",e[e.Input=5]="Input",e[e.TouchMove=6]="TouchMove",e[e.MediaInteraction=7]="MediaInteraction",e[e.StyleSheetRule=8]="StyleSheetRule",e[e.CanvasMutation=9]="CanvasMutation",e[e.Font=10]="Font",e[e.Log=11]="Log",e[e.Drag=12]="Drag",e[e.StyleDeclaration=13]="StyleDeclaration"}(Le||(Le={})),function(e){e[e.MouseUp=0]="MouseUp",e[e.MouseDown=1]="MouseDown",e[e.Click=2]="Click",e[e.ContextMenu=3]="ContextMenu",e[e.DblClick=4]="DblClick",e[e.Focus=5]="Focus",e[e.Blur=6]="Blur",e[e.TouchStart=7]="TouchStart",e[e.TouchMove_Departed=8]="TouchMove_Departed",e[e.TouchEnd=9]="TouchEnd",e[e.TouchCancel=10]="TouchCancel"}(Re||(Re={})),function(e){e[e.Play=0]="Play",e[e.Pause=1]="Pause",e[e.Seeked=2]="Seeked"}(Pe||(Pe={})),function(e){e.Start="start",e.Pause="pause",e.Resume="resume",e.Resize="resize",e.Finish="finish",e.FullsnapshotRebuilded="fullsnapshot-rebuilded",e.LoadStylesheetStart="load-stylesheet-start",e.LoadStylesheetEnd="load-stylesheet-end",e.SkipStart="skip-start",e.SkipEnd="skip-end",e.MouseInteraction="mouse-interaction",e.EventCast="event-cast",e.CustomEvent="custom-event",e.Flush="flush",e.StateChange="state-change",e.PlayBack="play-back"}(Fe||(Fe={}));var $e="Please stop import mirror directly. Instead of that,\r\nnow you can use replayer.getMirror() to access the mirror instance of a replayer,\r\nor you can use record.mirror to access the mirror instance during recording.",je={map:{},getId:function(){return console.error($e),-1},getNode:function(){return console.error($e),null},removeNodeFromMap:function(){console.error($e)},has:function(){return console.error($e),!1},reset:function(){console.error($e)}};function qe(e,t,n){void 0===n&&(n={});var r=null,o=0;return function(i){var s=Date.now();o||!1!==n.leading||(o=s);var a=t-(s-o),c=this,u=arguments;a<=0||a>t?(r&&(clearTimeout(r),r=null),o=s,e.apply(c,u)):r||!1===n.trailing||(r=setTimeout((function(){o=!1===n.leading?0:Date.now(),r=null,e.apply(c,u)}),a))}}function ze(e,t,n,r,o){void 0===o&&(o=window);var i=o.Object.getOwnPropertyDescriptor(e,t);return o.Object.defineProperty(e,t,r?n:{set:function(e){var t=this;setTimeout((function(){n.set.call(t,e)}),0),i&&i.set&&i.set.call(this,e)}}),function(){return ze(e,t,i||{},!0)}}function Ue(e,t,n){try{if(!(t in e))return function(){};var r=e[t],o=n(r);return"function"==typeof o&&(o.prototype=o.prototype||{},Object.defineProperties(o,{__rrweb_original__:{enumerable:!1,value:r}})),e[t]=o,function(){e[t]=r}}catch(e){return function(){}}}function Be(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function He(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function We(e,t,n){if(!e)return!1;if(e.nodeType===e.ELEMENT_NODE){var r=!1;return"string"==typeof t?r=e.classList.contains(t):e.classList.forEach((function(e){t.test(e)&&(r=!0)})),n&&(r=e.matches(n)),r||We(e.parentNode,t,n)}return e.nodeType,e.TEXT_NODE,We(e.parentNode,t,n)}function Xe(e){return"__sn"in e&&-2===e.__sn.id}function Qe(e){return Boolean(e.changedTouches)}"undefined"!=typeof window&&window.Proxy&&window.Reflect&&(je=new Proxy(je,{get:function(e,t,n){return"map"===t&&console.error($e),Reflect.get(e,t,n)}}));!function(){function e(){this.reset()}e.prototype.add=function(e){var t=this.indexes.get(e.parentId),n={id:e.node.id,mutation:e,children:[],texts:[],attributes:[]};t?(n.parent=t,t.children[n.id]=n):this.tree[n.id]=n,this.indexes.set(n.id,n)},e.prototype.remove=function(e,t){var n=this,r=this.indexes.get(e.parentId),o=this.indexes.get(e.id),i=function(e){n.removeIdSet.add(e);var r=t.getNode(e);null==r||r.childNodes.forEach((function(e){"__sn"in e&&i(e.__sn.id)}))},s=function(t){n.removeIdSet.add(t.id),Object.values(t.children).forEach((function(e){return s(e)}));var r=n.indexes.get(t.id);if(r){var o=r.parent;o&&(delete r.parent,delete o.children[r.id],n.indexes.delete(e.id))}};o?r?(delete o.parent,delete r.children[o.id],this.indexes.delete(e.id),s(o)):(delete this.tree[o.id],this.indexes.delete(o.id),s(o)):(this.removeNodeMutations.push(e),i(e.id))},e.prototype.text=function(e){var t=this.indexes.get(e.id);t?t.texts.push(e):this.textMutations.push(e)},e.prototype.attribute=function(e){var t=this.indexes.get(e.id);t?t.attributes.push(e):this.attributeMutations.push(e)},e.prototype.scroll=function(e){this.scrollMap.set(e.id,e)},e.prototype.input=function(e){this.inputMap.set(e.id,e)},e.prototype.flush=function(){var e,t,n,r,o=this,i=this.tree,s=this.removeNodeMutations,a=this.textMutations,c=this.attributeMutations,u={source:Le.Mutation,removes:s,texts:a,attributes:c,adds:[]},l=function(e,t){t&&o.removeIdSet.add(e.id),u.texts=u.texts.concat(t?[]:e.texts).filter((function(e){return!o.removeIdSet.has(e.id)})),u.attributes=u.attributes.concat(t?[]:e.attributes).filter((function(e){return!o.removeIdSet.has(e.id)})),o.removeIdSet.has(e.id)||o.removeIdSet.has(e.mutation.parentId)||t?Object.values(e.children).forEach((function(e){return l(e,!0)})):(u.adds.push(e.mutation),e.children&&Object.values(e.children).forEach((function(e){return l(e,!1)})))};Object.values(i).forEach((function(e){return l(e,!1)}));try{for(var d=ue(this.scrollMap.keys()),p=d.next();!p.done;p=d.next()){var h=p.value;this.removeIdSet.has(h)&&this.scrollMap.delete(h)}}catch(t){e={error:t}}finally{try{p&&!p.done&&(t=d.return)&&t.call(d)}finally{if(e)throw e.error}}try{for(var m=ue(this.inputMap.keys()),f=m.next();!f.done;f=m.next()){h=f.value;this.removeIdSet.has(h)&&this.inputMap.delete(h)}}catch(e){n={error:e}}finally{try{f&&!f.done&&(r=m.return)&&r.call(m)}finally{if(n)throw n.error}}var v=new Map(this.scrollMap),g=new Map(this.inputMap);return this.reset(),{mutationData:u,scrollMap:v,inputMap:g}},e.prototype.reset=function(){this.tree=[],this.indexes=new Map,this.removeNodeMutations=[],this.textMutations=[],this.attributeMutations=[],this.removeIdSet=new Set,this.scrollMap=new Map,this.inputMap=new Map},e.prototype.idRemoved=function(e){return this.removeIdSet.has(e)}}();function Je(e){return"__sn"in e&&(e.__sn.type===ae.Element&&"iframe"===e.__sn.tagName)}function Ge(e){var t;return Boolean(null===(t=e)||void 0===t?void 0:t.shadowRoot)}function Ye(e){return"__ln"in e}var Ke=function(){function e(){this.length=0,this.head=null}return e.prototype.get=function(e){if(e>=this.length)throw new Error("Position outside of list range");for(var t=this.head,n=0;n<e;n++)t=(null==t?void 0:t.next)||null;return t},e.prototype.addNode=function(e){var t={value:e,previous:null,next:null};if(e.__ln=t,e.previousSibling&&Ye(e.previousSibling)){var n=e.previousSibling.__ln.next;t.next=n,t.previous=e.previousSibling.__ln,e.previousSibling.__ln.next=t,n&&(n.previous=t)}else if(e.nextSibling&&Ye(e.nextSibling)&&e.nextSibling.__ln.previous){n=e.nextSibling.__ln.previous;t.previous=n,t.next=e.nextSibling.__ln,e.nextSibling.__ln.previous=t,n&&(n.next=t)}else this.head&&(this.head.previous=t),t.next=this.head,this.head=t;this.length++},e.prototype.removeNode=function(e){var t=e.__ln;this.head&&(t.previous?(t.previous.next=t.next,t.next&&(t.next.previous=t.previous)):(this.head=t.next,this.head&&(this.head.previous=null)),e.__ln&&delete e.__ln,this.length--)},e}(),Ze=function(e,t){return e+"@"+t};function et(e){return"__sn"in e}var tt=function(){function e(){var e=this;this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=function(t){t.forEach(e.processMutation),e.emit()},this.emit=function(){var t,n,r,o;if(!e.frozen&&!e.locked){for(var i=[],s=new Ke,a=function(t){for(var n=t,r=-2;-2===r;)r=(n=n&&n.nextSibling)&&e.mirror.getId(n);return r},c=function(t){var n,r=t.getRootNode?null===(n=t.getRootNode())||void 0===n?void 0:n.host:null,o=!(e.doc.contains(t)||r instanceof Node&&e.doc.contains(r));if(t.parentNode&&!o){var c=he(t.parentNode)?e.mirror.getId(r):e.mirror.getId(t.parentNode),u=a(t);if(-1===c||-1===u)return s.addNode(t);var l=De(t,{doc:e.doc,map:e.mirror.map,blockClass:e.blockClass,blockSelector:e.blockSelector,maskTextClass:e.maskTextClass,maskTextSelector:e.maskTextSelector,skipChild:!0,inlineStylesheet:e.inlineStylesheet,maskInputOptions:e.maskInputOptions,maskTextFn:e.maskTextFn,maskInputFn:e.maskInputFn,slimDOMOptions:e.slimDOMOptions,recordCanvas:e.recordCanvas,onSerialize:function(n){Je(n)&&e.iframeManager.addIframe(n),Ge(t)&&e.shadowDomManager.addShadowRoot(t.shadowRoot,document)},onIframeLoad:function(t,n){e.iframeManager.attachIframe(t,n)}});l&&i.push({parentId:c,nextId:u,node:l})}};e.mapRemoves.length;)e.mirror.removeNodeFromMap(e.mapRemoves.shift());try{for(var u=ue(e.movedSet),l=u.next();!l.done;l=u.next()){var d=l.value;rt(e.removes,d,e.mirror)&&!e.movedSet.has(d.parentNode)||c(d)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}try{for(var p=ue(e.addedSet),h=p.next();!h.done;h=p.next()){d=h.value;ot(e.droppedSet,d)||rt(e.removes,d,e.mirror)?ot(e.movedSet,d)?c(d):e.droppedSet.add(d):c(d)}}catch(e){r={error:e}}finally{try{h&&!h.done&&(o=p.return)&&o.call(p)}finally{if(r)throw r.error}}for(var m=null;s.length;){var f=null;if(m){var v=e.mirror.getId(m.value.parentNode),g=a(m.value);-1!==v&&-1!==g&&(f=m)}if(!f)for(var y=s.length-1;y>=0;y--){var b=s.get(y);if(b){v=e.mirror.getId(b.value.parentNode),g=a(b.value);if(-1!==v&&-1!==g){f=b;break}}}if(!f){for(;s.head;)s.removeNode(s.head.value);break}m=f.previous,s.removeNode(f.value),c(f.value)}var w={texts:e.texts.map((function(t){return{id:e.mirror.getId(t.node),value:t.value}})).filter((function(t){return e.mirror.has(t.id)})),attributes:e.attributes.map((function(t){return{id:e.mirror.getId(t.node),attributes:t.attributes}})).filter((function(t){return e.mirror.has(t.id)})),removes:e.removes,adds:i};(w.texts.length||w.attributes.length||w.removes.length||w.adds.length)&&(e.texts=[],e.attributes=[],e.removes=[],e.addedSet=new Set,e.movedSet=new Set,e.droppedSet=new Set,e.movedMap={},e.emissionCallback(w))}},this.processMutation=function(t){var n,r,o,i;if(!Xe(t.target))switch(t.type){case"characterData":var s=t.target.textContent;We(t.target,e.blockClass,e.blockSelector)||s===t.oldValue||e.texts.push({value:xe(t.target,e.maskTextClass,e.maskTextSelector)&&s?e.maskTextFn?e.maskTextFn(s):s.replace(/[\S]/g,"*"):s,node:t.target});break;case"attributes":var a=t.target;s=t.target.getAttribute(t.attributeName);if("value"===t.attributeName&&(s=me({maskInputOptions:e.maskInputOptions,tagName:t.target.tagName,type:t.target.getAttribute("type"),value:s,maskInputFn:e.maskInputFn})),We(t.target,e.blockClass,e.blockSelector)||s===t.oldValue)return;var c=e.attributes.find((function(e){return e.node===t.target}));if(c||(c={node:t.target,attributes:{}},e.attributes.push(c)),"style"===t.attributeName){var u=e.doc.createElement("span");t.oldValue&&u.setAttribute("style",t.oldValue),void 0!==c.attributes.style&&null!==c.attributes.style||(c.attributes.style={});var l=c.attributes.style;try{for(var d=ue(Array.from(a.style)),p=d.next();!p.done;p=d.next()){var h=p.value,m=a.style.getPropertyValue(h),f=a.style.getPropertyPriority(h);m===u.style.getPropertyValue(h)&&f===u.style.getPropertyPriority(h)||(l[h]=""===f?m:[m,f])}}catch(e){n={error:e}}finally{try{p&&!p.done&&(r=d.return)&&r.call(d)}finally{if(n)throw n.error}}try{for(var v=ue(Array.from(u.style)),g=v.next();!g.done;g=v.next()){h=g.value;""!==a.style.getPropertyValue(h)&&a.style.getPropertyValue(h)||(l[h]=!1)}}catch(e){o={error:e}}finally{try{g&&!g.done&&(i=v.return)&&i.call(v)}finally{if(o)throw o.error}}}else c.attributes[t.attributeName]=Ee(e.doc,t.target.tagName,t.attributeName,s);break;case"childList":t.addedNodes.forEach((function(n){return e.genAdds(n,t.target)})),t.removedNodes.forEach((function(n){var r=e.mirror.getId(n),o=he(t.target)?e.mirror.getId(t.target.host):e.mirror.getId(t.target);We(t.target,e.blockClass,e.blockSelector)||Xe(n)||(e.addedSet.has(n)?(nt(e.addedSet,n),e.droppedSet.add(n)):e.addedSet.has(t.target)&&-1===r||function e(t,n){if(he(t))return!1;var r=n.getId(t);return!n.has(r)||(!t.parentNode||t.parentNode.nodeType!==t.DOCUMENT_NODE)&&(!t.parentNode||e(t.parentNode,n))}(t.target,e.mirror)||(e.movedSet.has(n)&&e.movedMap[Ze(r,o)]?nt(e.movedSet,n):e.removes.push({parentId:o,id:r,isShadow:!!he(t.target)||void 0})),e.mapRemoves.push(n))}))}},this.genAdds=function(t,n){if(!n||!We(n,e.blockClass,e.blockSelector)){if(et(t)){if(Xe(t))return;e.movedSet.add(t);var r=null;n&&et(n)&&(r=n.__sn.id),r&&(e.movedMap[Ze(t.__sn.id,r)]=!0)}else e.addedSet.add(t),e.droppedSet.delete(t);We(t,e.blockClass,e.blockSelector)||t.childNodes.forEach((function(t){return e.genAdds(t)}))}}}return e.prototype.init=function(e,t,n,r,o,i,s,a,c,u,l,d,p,h,m){this.blockClass=t,this.blockSelector=n,this.maskTextClass=r,this.maskTextSelector=o,this.inlineStylesheet=i,this.maskInputOptions=s,this.maskTextFn=a,this.maskInputFn=c,this.recordCanvas=u,this.slimDOMOptions=l,this.emissionCallback=e,this.doc=d,this.mirror=p,this.iframeManager=h,this.shadowDomManager=m},e.prototype.freeze=function(){this.frozen=!0},e.prototype.unfreeze=function(){this.frozen=!1,this.emit()},e.prototype.isFrozen=function(){return this.frozen},e.prototype.lock=function(){this.locked=!0},e.prototype.unlock=function(){this.locked=!1,this.emit()},e}();function nt(e,t){e.delete(t),t.childNodes.forEach((function(t){return nt(e,t)}))}function rt(e,t,n){var r=t.parentNode;if(!r)return!1;var o=n.getId(r);return!!e.some((function(e){return e.id===o}))||rt(e,r,n)}function ot(e,t){var n=t.parentNode;return!!n&&(!!e.has(n)||ot(e,n))}var it=[],st="undefined"!=typeof CSSGroupingRule,at="undefined"!=typeof CSSMediaRule,ct="undefined"!=typeof CSSSupportsRule,ut="undefined"!=typeof CSSConditionRule;function lt(e){try{if("composedPath"in e){var t=e.composedPath();if(t.length)return t[0]}else if("path"in e&&e.path.length)return e.path[0];return e.target}catch(t){return e.target}}function dt(e,t,n,r,o,i,s,a,c,u,l,d,p,h,m,f){var v,g,y,b=new tt;it.push(b),b.init(e,n,r,o,i,s,a,c,u,l,d,t,p,h,m);var w=window.MutationObserver||window.__rrMutationObserver,S=null===(y=null===(g=null===(v=window)||void 0===v?void 0:v.Zone)||void 0===g?void 0:g.__symbol__)||void 0===y?void 0:y.call(g,"MutationObserver");S&&window[S]&&(w=window[S]);var C=new w(b.processMutations.bind(b));return C.observe(f,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),C}function pt(e,t,n,r,o,i){if(!1===i.mouseInteraction)return function(){};var s=!0===i.mouseInteraction||void 0===i.mouseInteraction?{}:i.mouseInteraction,a=[];return Object.keys(Re).filter((function(e){return Number.isNaN(Number(e))&&!e.endsWith("_Departed")&&!1!==s[e]})).forEach((function(i){var s=i.toLowerCase(),c=function(t){return function(i){var s=lt(i);if(!We(s,r,o)){var a=Qe(i)?i.changedTouches[0]:i;if(a){var c=n.getId(s),u=a.clientX,l=a.clientY;e({type:Re[t],id:c,x:u,y:l})}}}}(i);a.push(Ve(s,c,t))})),function(){a.forEach((function(e){return e()}))}}function ht(e,t,n,r,o,i){return Ve("scroll",qe((function(i){var s=lt(i);if(s&&!We(s,r,o)){var a=n.getId(s);if(s===t){var c=t.scrollingElement||t.documentElement;e({id:a,x:c.scrollLeft,y:c.scrollTop})}else e({id:a,x:s.scrollLeft,y:s.scrollTop})}}),i.scroll||100),t)}function mt(e,t){var n=ce({},e);return t||delete n.userTriggered,n}var ft=["INPUT","TEXTAREA","SELECT"],vt=new WeakMap;function gt(e){return function(e,t){if(st&&e.parentRule instanceof CSSGroupingRule||at&&e.parentRule instanceof CSSMediaRule||ct&&e.parentRule instanceof CSSSupportsRule||ut&&e.parentRule instanceof CSSConditionRule){var n=Array.from(e.parentRule.cssRules).indexOf(e);t.unshift(n)}else{n=Array.from(e.parentStyleSheet.cssRules).indexOf(e);t.unshift(n)}return t}(e,[])}function yt(e,t){var n,r;void 0===t&&(t={});var o=e.doc.defaultView;if(!o)return function(){};!function(e,t){var n=e.mutationCb,r=e.mousemoveCb,o=e.mouseInteractionCb,i=e.scrollCb,s=e.viewportResizeCb,a=e.inputCb,c=e.mediaInteractionCb,u=e.styleSheetRuleCb,l=e.styleDeclarationCb,d=e.canvasMutationCb,p=e.fontCb;e.mutationCb=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];t.mutation&&t.mutation.apply(t,de(e)),n.apply(void 0,de(e))},e.mousemoveCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.mousemove&&t.mousemove.apply(t,de(e)),r.apply(void 0,de(e))},e.mouseInteractionCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.mouseInteraction&&t.mouseInteraction.apply(t,de(e)),o.apply(void 0,de(e))},e.scrollCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.scroll&&t.scroll.apply(t,de(e)),i.apply(void 0,de(e))},e.viewportResizeCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.viewportResize&&t.viewportResize.apply(t,de(e)),s.apply(void 0,de(e))},e.inputCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.input&&t.input.apply(t,de(e)),a.apply(void 0,de(e))},e.mediaInteractionCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.mediaInteaction&&t.mediaInteaction.apply(t,de(e)),c.apply(void 0,de(e))},e.styleSheetRuleCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.styleSheetRule&&t.styleSheetRule.apply(t,de(e)),u.apply(void 0,de(e))},e.styleDeclarationCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.styleDeclaration&&t.styleDeclaration.apply(t,de(e)),l.apply(void 0,de(e))},e.canvasMutationCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.canvasMutation&&t.canvasMutation.apply(t,de(e)),d.apply(void 0,de(e))},e.fontCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.font&&t.font.apply(t,de(e)),p.apply(void 0,de(e))}}(e,t);var i,s,a,c=dt(e.mutationCb,e.doc,e.blockClass,e.blockSelector,e.maskTextClass,e.maskTextSelector,e.inlineStylesheet,e.maskInputOptions,e.maskTextFn,e.maskInputFn,e.recordCanvas,e.slimDOMOptions,e.mirror,e.iframeManager,e.shadowDomManager,e.doc),u=function(e,t,n,r){if(!1===t.mousemove)return function(){};var o,i="number"==typeof t.mousemove?t.mousemove:50,s="number"==typeof t.mousemoveCallback?t.mousemoveCallback:500,a=[],c=qe((function(t){var n=Date.now()-o;e(a.map((function(e){return e.timeOffset-=n,e})),t),a=[],o=null}),s),u=qe((function(e){var t=lt(e),n=Qe(e)?e.changedTouches[0]:e,i=n.clientX,s=n.clientY;o||(o=Date.now()),a.push({x:i,y:s,id:r.getId(t),timeOffset:Date.now()-o}),c("undefined"!=typeof DragEvent&&e instanceof DragEvent?Le.Drag:e instanceof MouseEvent?Le.MouseMove:Le.TouchMove)}),i,{trailing:!1}),l=[Ve("mousemove",u,n),Ve("touchmove",u,n),Ve("drag",u,n)];return function(){l.forEach((function(e){return e()}))}}(e.mousemoveCb,e.sampling,e.doc,e.mirror),l=pt(e.mouseInteractionCb,e.doc,e.mirror,e.blockClass,e.blockSelector,e.sampling),d=ht(e.scrollCb,e.doc,e.mirror,e.blockClass,e.blockSelector,e.sampling),p=(i=e.viewportResizeCb,s=-1,a=-1,Ve("resize",qe((function(){var e=Be(),t=He();s===e&&a===t||(i({width:Number(t),height:Number(e)}),s=e,a=t)}),200),window)),h=function(e,t,n,r,o,i,s,a,c,u){function l(e){var n=lt(e),c=e.isTrusted;if(n&&n.tagName&&!(ft.indexOf(n.tagName)<0)&&!We(n,r,o)){var l=n.type;if(!n.classList.contains(i)){var p=n.value,h=!1;"radio"===l||"checkbox"===l?h=n.checked:(s[n.tagName.toLowerCase()]||s[l])&&(p=me({maskInputOptions:s,tagName:n.tagName,type:l,value:p,maskInputFn:a})),d(n,mt({text:p,isChecked:h,userTriggered:c},u));var m=n.name;"radio"===l&&m&&h&&t.querySelectorAll('input[type="radio"][name="'+m+'"]').forEach((function(e){e!==n&&d(e,mt({text:e.value,isChecked:!h,userTriggered:!1},u))}))}}}function d(t,r){var o=vt.get(t);if(!o||o.text!==r.text||o.isChecked!==r.isChecked){vt.set(t,r);var i=n.getId(t);e(ce(ce({},r),{id:i}))}}var p=("last"===c.input?["change"]:["input","change"]).map((function(e){return Ve(e,l,t)})),h=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value"),m=[[HTMLInputElement.prototype,"value"],[HTMLInputElement.prototype,"checked"],[HTMLSelectElement.prototype,"value"],[HTMLTextAreaElement.prototype,"value"],[HTMLSelectElement.prototype,"selectedIndex"]];return h&&h.set&&p.push.apply(p,de(m.map((function(e){return ze(e[0],e[1],{set:function(){l({target:this})}})})))),function(){p.forEach((function(e){return e()}))}}(e.inputCb,e.doc,e.mirror,e.blockClass,e.blockSelector,e.ignoreClass,e.maskInputOptions,e.maskInputFn,e.sampling,e.userTriggeredOnInput),m=function(e,t,n,r){var o=function(o){return function(i){var s=lt(i);s&&!We(s,t,n)&&e({type:o,id:r.getId(s),currentTime:s.currentTime})}},i=[Ve("play",o(0)),Ve("pause",o(1)),Ve("seeked",o(2))];return function(){i.forEach((function(e){return e()}))}}(e.mediaInteractionCb,e.blockClass,e.blockSelector,e.mirror),f=function(e,t,n){var r=t.CSSStyleSheet.prototype.insertRule;t.CSSStyleSheet.prototype.insertRule=function(t,o){var i=n.getId(this.ownerNode);return-1!==i&&e({id:i,adds:[{rule:t,index:o}]}),r.apply(this,arguments)};var o=t.CSSStyleSheet.prototype.deleteRule;t.CSSStyleSheet.prototype.deleteRule=function(t){var r=n.getId(this.ownerNode);return-1!==r&&e({id:r,removes:[{index:t}]}),o.apply(this,arguments)};var i={};st?i.CSSGroupingRule=t.CSSGroupingRule:(at&&(i.CSSMediaRule=t.CSSMediaRule),ut&&(i.CSSConditionRule=t.CSSConditionRule),ct&&(i.CSSSupportsRule=t.CSSSupportsRule));var s={};return Object.entries(i).forEach((function(t){var r=le(t,2),o=r[0],i=r[1];s[o]={insertRule:i.prototype.insertRule,deleteRule:i.prototype.deleteRule},i.prototype.insertRule=function(t,r){var i=n.getId(this.parentStyleSheet.ownerNode);return-1!==i&&e({id:i,adds:[{rule:t,index:de(gt(this),[r||0])}]}),s[o].insertRule.apply(this,arguments)},i.prototype.deleteRule=function(t){var r=n.getId(this.parentStyleSheet.ownerNode);return-1!==r&&e({id:r,removes:[{index:de(gt(this),[t])}]}),s[o].deleteRule.apply(this,arguments)}})),function(){t.CSSStyleSheet.prototype.insertRule=r,t.CSSStyleSheet.prototype.deleteRule=o,Object.entries(i).forEach((function(e){var t=le(e,2),n=t[0],r=t[1];r.prototype.insertRule=s[n].insertRule,r.prototype.deleteRule=s[n].deleteRule}))}}(e.styleSheetRuleCb,o,e.mirror),v=function(e,t,n){var r=t.CSSStyleDeclaration.prototype.setProperty;t.CSSStyleDeclaration.prototype.setProperty=function(t,o,i){var s,a,c=n.getId(null===(a=null===(s=this.parentRule)||void 0===s?void 0:s.parentStyleSheet)||void 0===a?void 0:a.ownerNode);return-1!==c&&e({id:c,set:{property:t,value:o,priority:i},index:gt(this.parentRule)}),r.apply(this,arguments)};var o=t.CSSStyleDeclaration.prototype.removeProperty;return t.CSSStyleDeclaration.prototype.removeProperty=function(t){var r,i,s=n.getId(null===(i=null===(r=this.parentRule)||void 0===r?void 0:r.parentStyleSheet)||void 0===i?void 0:i.ownerNode);return-1!==s&&e({id:s,remove:{property:t},index:gt(this.parentRule)}),o.apply(this,arguments)},function(){t.CSSStyleDeclaration.prototype.setProperty=r,t.CSSStyleDeclaration.prototype.removeProperty=o}}(e.styleDeclarationCb,o,e.mirror),g=e.recordCanvas?function(e,t,n,r){var o,i,s=Object.getOwnPropertyNames(t.CanvasRenderingContext2D.prototype),a=[],c=function(o){try{if("function"!=typeof t.CanvasRenderingContext2D.prototype[o])return"continue";var i=Ue(t.CanvasRenderingContext2D.prototype,o,(function(t){return function(){for(var i=this,s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];return We(this.canvas,n,null)||setTimeout((function(){var t=de(s);if("drawImage"===o&&t[0]&&t[0]instanceof HTMLCanvasElement){var n=t[0],a=n.getContext("2d"),c=null==a?void 0:a.getImageData(0,0,n.width,n.height),u=null==c?void 0:c.data;t[0]=JSON.stringify(u)}e({id:r.getId(i.canvas),property:o,args:t})}),0),t.apply(this,s)}}));a.push(i)}catch(n){var s=ze(t.CanvasRenderingContext2D.prototype,o,{set:function(t){e({id:r.getId(this.canvas),property:o,args:[t],setter:!0})}});a.push(s)}};try{for(var u=ue(s),l=u.next();!l.done;l=u.next()){c(l.value)}}catch(e){o={error:e}}finally{try{l&&!l.done&&(i=u.return)&&i.call(u)}finally{if(o)throw o.error}}return function(){a.forEach((function(e){return e()}))}}(e.canvasMutationCb,o,e.blockClass,e.mirror):function(){},y=e.collectFonts?function(e,t){var n=t.defaultView;if(!n)return function(){};var r=[],o=new WeakMap,i=n.FontFace;n.FontFace=function(e,t,n){var r=new i(e,t,n);return o.set(r,{family:e,buffer:"string"!=typeof t,descriptors:n,fontSource:"string"==typeof t?t:JSON.stringify(Array.from(new Uint8Array(t)))}),r};var s=Ue(t.fonts,"add",(function(t){return function(n){return setTimeout((function(){var t=o.get(n);t&&(e(t),o.delete(n))}),0),t.apply(this,[n])}}));return r.push((function(){n.FontFace=i})),r.push(s),function(){r.forEach((function(e){return e()}))}}(e.fontCb,e.doc):function(){},b=[];try{for(var w=ue(e.plugins),S=w.next();!S.done;S=w.next()){var C=S.value;b.push(C.observer(C.callback,o,C.options))}}catch(e){n={error:e}}finally{try{S&&!S.done&&(r=w.return)&&r.call(w)}finally{if(n)throw n.error}}return function(){c.disconnect(),u(),l(),d(),p(),h(),m(),f(),v(),g(),y(),b.forEach((function(e){return e()}))}}var bt,wt,St=function(){function e(e){this.iframes=new WeakMap,this.mutationCb=e.mutationCb}return e.prototype.addIframe=function(e){this.iframes.set(e,!0)},e.prototype.addLoadListener=function(e){this.loadListener=e},e.prototype.attachIframe=function(e,t){var n;this.mutationCb({adds:[{parentId:e.__sn.id,nextId:null,node:t}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),null===(n=this.loadListener)||void 0===n||n.call(this,e)},e}(),Ct=function(){function e(e){this.mutationCb=e.mutationCb,this.scrollCb=e.scrollCb,this.bypassOptions=e.bypassOptions,this.mirror=e.mirror}return e.prototype.addShadowRoot=function(e,t){dt(this.mutationCb,t,this.bypassOptions.blockClass,this.bypassOptions.blockSelector,this.bypassOptions.maskTextClass,this.bypassOptions.maskTextSelector,this.bypassOptions.inlineStylesheet,this.bypassOptions.maskInputOptions,this.bypassOptions.maskTextFn,this.bypassOptions.maskInputFn,this.bypassOptions.recordCanvas,this.bypassOptions.slimDOMOptions,this.mirror,this.bypassOptions.iframeManager,this,e),ht(this.scrollCb,e,this.mirror,this.bypassOptions.blockClass,this.bypassOptions.blockSelector,this.bypassOptions.sampling)},e}();function kt(e){return ce(ce({},e),{timestamp:Date.now()})}var It={map:{},getId:function(e){return e&&e.__sn?e.__sn.id:-1},getNode:function(e){return this.map[e]||null},removeNodeFromMap:function(e){var t=this,n=e.__sn&&e.__sn.id;delete this.map[n],e.childNodes&&e.childNodes.forEach((function(e){return t.removeNodeFromMap(e)}))},has:function(e){return this.map.hasOwnProperty(e)},reset:function(){this.map={}}};function _t(e){void 0===e&&(e={});var t=e.emit,n=e.checkoutEveryNms,r=e.checkoutEveryNth,o=e.blockClass,i=void 0===o?"rr-block":o,s=e.blockSelector,a=void 0===s?null:s,c=e.ignoreClass,u=void 0===c?"rr-ignore":c,l=e.maskTextClass,d=void 0===l?"rr-mask":l,p=e.maskTextSelector,h=void 0===p?null:p,m=e.inlineStylesheet,f=void 0===m||m,v=e.maskAllInputs,g=e.maskInputOptions,y=e.slimDOMOptions,b=e.maskInputFn,w=e.maskTextFn,S=e.hooks,C=e.packFn,k=e.sampling,I=void 0===k?{}:k,_=e.mousemoveWait,T=e.recordCanvas,E=void 0!==T&&T,x=e.userTriggeredOnInput,M=void 0!==x&&x,N=e.collectFonts,D=void 0!==N&&N,O=e.plugins,L=e.keepIframeSrcFn,R=void 0===L?function(){return!1}:L;if(!t)throw new Error("emit function is required");void 0!==_&&void 0===I.mousemove&&(I.mousemove=_);var P,F,A=!0===v?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:void 0!==g?g:{password:!0},V=!0===y||"all"===y?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:"all"===y,headMetaDescKeywords:"all"===y}:y||{};void 0===P&&(P=window),"NodeList"in P&&!P.NodeList.prototype.forEach&&(P.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in P&&!P.DOMTokenList.prototype.forEach&&(P.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=function(e){if(!(0 in arguments))throw new TypeError("1 argument is required");do{if(this===e)return!0}while(e=e&&e.parentNode);return!1});var $=0;bt=function(e,o){var i;if(!(null===(i=it[0])||void 0===i?void 0:i.isFrozen())||e.type===Oe.FullSnapshot||e.type===Oe.IncrementalSnapshot&&e.data.source===Le.Mutation||it.forEach((function(e){return e.unfreeze()})),t(C?C(e):e,o),e.type===Oe.FullSnapshot)F=e,$=0;else if(e.type===Oe.IncrementalSnapshot){if(e.data.source===Le.Mutation&&e.data.isAttachIframe)return;$++;var s=r&&$>=r,a=n&&e.timestamp-F.timestamp>n;(s||a)&&wt(!0)}};var j=function(e){bt(kt({type:Oe.IncrementalSnapshot,data:ce({source:Le.Mutation},e)}))},q=function(e){return bt(kt({type:Oe.IncrementalSnapshot,data:ce({source:Le.Scroll},e)}))},z=new St({mutationCb:j}),U=new Ct({mutationCb:j,scrollCb:q,bypassOptions:{blockClass:i,blockSelector:a,maskTextClass:d,maskTextSelector:h,inlineStylesheet:f,maskInputOptions:A,maskTextFn:w,maskInputFn:b,recordCanvas:E,sampling:I,slimDOMOptions:V,iframeManager:z},mirror:It});wt=function(e){var t,n,r,o;void 0===e&&(e=!1),bt(kt({type:Oe.Meta,data:{href:window.location.href,width:He(),height:Be()}}),e),it.forEach((function(e){return e.lock()}));var s=le(function(e,t){var n=t||{},r=n.blockClass,o=void 0===r?"rr-block":r,i=n.blockSelector,s=void 0===i?null:i,a=n.maskTextClass,c=void 0===a?"rr-mask":a,u=n.maskTextSelector,l=void 0===u?null:u,d=n.inlineStylesheet,p=void 0===d||d,h=n.recordCanvas,m=void 0!==h&&h,f=n.maskAllInputs,v=void 0!==f&&f,g=n.maskTextFn,y=n.maskInputFn,b=n.slimDOM,w=void 0!==b&&b,S=n.preserveWhiteSpace,C=n.onSerialize,k=n.onIframeLoad,I=n.iframeLoadTimeout,_=n.keepIframeSrcFn,T={};return[De(e,{doc:e,map:T,blockClass:o,blockSelector:s,maskTextClass:c,maskTextSelector:l,skipChild:!1,inlineStylesheet:p,maskInputOptions:!0===v?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:!1===v?{password:!0}:v,maskTextFn:g,maskInputFn:y,slimDOMOptions:!0===w||"all"===w?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:"all"===w,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:!1===w?{}:w,recordCanvas:m,preserveWhiteSpace:S,onSerialize:C,onIframeLoad:k,iframeLoadTimeout:I,keepIframeSrcFn:void 0===_?function(){return!1}:_}),T]}(document,{blockClass:i,blockSelector:a,maskTextClass:d,maskTextSelector:h,inlineStylesheet:f,maskAllInputs:A,maskTextFn:w,slimDOM:V,recordCanvas:E,onSerialize:function(e){Je(e)&&z.addIframe(e),Ge(e)&&U.addShadowRoot(e.shadowRoot,document)},onIframeLoad:function(e,t){z.attachIframe(e,t)},keepIframeSrcFn:R}),2),c=s[0],u=s[1];if(!c)return console.warn("Failed to snapshot the document");It.map=u,bt(kt({type:Oe.FullSnapshot,data:{node:c,initialOffset:{left:void 0!==window.pageXOffset?window.pageXOffset:(null===document||void 0===document?void 0:document.documentElement.scrollLeft)||(null===(n=null===(t=null===document||void 0===document?void 0:document.body)||void 0===t?void 0:t.parentElement)||void 0===n?void 0:n.scrollLeft)||(null===document||void 0===document?void 0:document.body.scrollLeft)||0,top:void 0!==window.pageYOffset?window.pageYOffset:(null===document||void 0===document?void 0:document.documentElement.scrollTop)||(null===(o=null===(r=null===document||void 0===document?void 0:document.body)||void 0===r?void 0:r.parentElement)||void 0===o?void 0:o.scrollTop)||(null===document||void 0===document?void 0:document.body.scrollTop)||0}}})),it.forEach((function(e){return e.unlock()}))};try{var B=[];B.push(Ve("DOMContentLoaded",(function(){bt(kt({type:Oe.DomContentLoaded,data:{}}))})));var H=function(e){return yt({mutationCb:j,mousemoveCb:function(e,t){return bt(kt({type:Oe.IncrementalSnapshot,data:{source:t,positions:e}}))},mouseInteractionCb:function(e){return bt(kt({type:Oe.IncrementalSnapshot,data:ce({source:Le.MouseInteraction},e)}))},scrollCb:q,viewportResizeCb:function(e){return bt(kt({type:Oe.IncrementalSnapshot,data:ce({source:Le.ViewportResize},e)}))},inputCb:function(e){return bt(kt({type:Oe.IncrementalSnapshot,data:ce({source:Le.Input},e)}))},mediaInteractionCb:function(e){return bt(kt({type:Oe.IncrementalSnapshot,data:ce({source:Le.MediaInteraction},e)}))},styleSheetRuleCb:function(e){return bt(kt({type:Oe.IncrementalSnapshot,data:ce({source:Le.StyleSheetRule},e)}))},styleDeclarationCb:function(e){return bt(kt({type:Oe.IncrementalSnapshot,data:ce({source:Le.StyleDeclaration},e)}))},canvasMutationCb:function(e){return bt(kt({type:Oe.IncrementalSnapshot,data:ce({source:Le.CanvasMutation},e)}))},fontCb:function(e){return bt(kt({type:Oe.IncrementalSnapshot,data:ce({source:Le.Font},e)}))},blockClass:i,ignoreClass:u,maskTextClass:d,maskTextSelector:h,maskInputOptions:A,inlineStylesheet:f,sampling:I,recordCanvas:E,userTriggeredOnInput:M,collectFonts:D,doc:e,maskInputFn:b,maskTextFn:w,blockSelector:a,slimDOMOptions:V,mirror:It,iframeManager:z,shadowDomManager:U,plugins:(null==O?void 0:O.map((function(e){return{observer:e.observer,options:e.options,callback:function(t){return bt(kt({type:Oe.Plugin,data:{plugin:e.name,payload:t}}))}}})))||[]},S)};z.addLoadListener((function(e){(function(e){var t=null;try{t=e.contentDocument.body.innerHTML}catch(e){}return null!==t})(e)&&B.push(H(e.contentDocument))}));var W=function(){wt(),B.push(H(document))};return"interactive"===document.readyState||"complete"===document.readyState?W():B.push(Ve("load",(function(){bt(kt({type:Oe.Load,data:{}})),W()}),window)),function(){B.forEach((function(e){return e()}))}}catch(e){console.warn(e)}}_t.addCustomEvent=function(e,t){if(!bt)throw new Error("please add custom event after start recording");bt(kt({type:Oe.Custom,data:{tag:e,payload:t}}))},_t.freezePage=function(){it.forEach((function(e){return e.freeze()}))},_t.takeFullSnapshot=function(e){if(!wt)throw new Error("please take full snapshot after start recording");wt(e)},_t.mirror=It;var Tt=_t.addCustomEvent;_t.freezePage;class Et{constructor(){this.eventBuffer=[],this.vfCounter=0,this.didSetupRecorder=!1,this.recordStopper=null,this.firstRecordedTimestamp=null,this.lastRecordedTimestamp=null,this.invalidVideoLength=!1,this.lastFragPostTimestamp=new Date,this.pauseTimeout=!1,this.freezingEvents=!1,this.setupUnloadHandler()}static configureInstance(){this.instance||(this.instance=new Et,window.addEventListener("click",()=>{this.instance.handleFragPost()}))}static getInstance(){if(!this.instance)throw new Error("SessionRecorder was not configured");return this.instance}setupUnloadHandler(){window.addEventListener("unload",()=>{this.handleFragPost()})}recordUserSession(){if(this.didSetupRecorder)return;const e=this,t={emit(t){e.handleNewRRwebEvent(t,2e3)},inlineStylesheet:!1,maskAllInputs:!0,blockSelector:x()};e.recordStopper=_t(t),this.didSetupRecorder=!0}handleNewRRwebEvent(e,t){if(j.getInstance().closeIfInactive())return void(this.recordStopper&&this.recordStopper());if(5===e.type&&"unfreeze"===e.data.tag)return;3===e.type&&0===e.data.source||(this.pauseTimeout&&(clearTimeout(this.pauseTimeout),this.freezingEvents=!1),this.pauseTimeout=setTimeout((function(){Et.getInstance().freezingEvents=!0,_t.freezePage()}),t)),(!this.firstRecordedTimestamp||e.timestamp<this.firstRecordedTimestamp)&&(this.firstRecordedTimestamp=e.timestamp),(!this.lastRecordedTimestamp||e.timestamp>this.lastRecordedTimestamp)&&(this.lastRecordedTimestamp=e.timestamp),this.eventBuffer.push(e),3!==e.type||2!==e.data.source||2!==e.data.type&&4!==e.data.type||V.getInstance().addVideoClick();const n=new Date;n.setMilliseconds(n.getMilliseconds()-500),(this.eventBuffer.length>=10||this.lastFragPostTimestamp<n)&&this.handleFragPost()}handleFragPost(){if(!j.getInstance().closeIfInactive()&&this.didSetupRecorder&&0!==this.eventBuffer.length){try{let e=0;this.firstRecordedTimestamp&&this.lastRecordedTimestamp&&!this.invalidVideoLength&&(e=this.lastRecordedTimestamp-this.firstRecordedTimestamp),!this.invalidVideoLength&&(e<0||e>=Number.MAX_SAFE_INTEGER)&&(A.getInstance().postNoibuErrorAndOptionallyDisableClient(`video lengthMS is invalid: ${e}, start time: ${this.firstRecordedTimestamp}, end time: `+this.lastRecordedTimestamp,!1,"error"),this.invalidVideoLength=!0,e=0),this.vfCounter+=1,this.eventBuffer.sort((e,t)=>e.timestamp-t.timestamp);const t={};t.vid=_(this.eventBuffer),t.seq=this.vfCounter,t.len=e,j.getInstance().addEndTimeToPayload(t),V.getInstance().addVideoFragData(this.vfCounter,e);const n={};n.pvvf=t,j.getInstance().sendMessage("v",n),this.lastFragPostTimestamp=new Date}catch(e){A.getInstance().postNoibuErrorAndOptionallyDisableClient("video frag socket closed with err: "+e.message,!1,"error"),this.recordStopper&&this.recordStopper()}this.eventBuffer=[]}}unfreeze(){this.freezingEvents&&Tt("unfreeze",{})}}!function(t){if(M())return;if(function(t){for(let n=0;n<e.length;n+=1){if(!t[e[n]])return!0}return!1}(t))return;if(!window.location.href.startsWith("http"))return;const n=p()(),r=t.metroplexHTTPBase+"/collect_error";if(A.configureInstance(r),A.getInstance().isClientDisabled)return;if(function(){const e=void 0!==window.noibuJSLoaded;return window.noibuJSLoaded=!0,e}())return void A.getInstance().postNoibuErrorAndOptionallyDisableClient("NoibuJS script already present in DOM, disabling client",!0,"warn");j.getInstance(n),Et.configureInstance(),q.configureInstance();const o=Et.getInstance();$.getInstance();const i=new ie,s=oe.getInstance();J(),Z(),s.monitorClicks(),setInterval((function(){if(se!==window.location.href){se=window.location.href;const e={url:k()};z.getInstance().addEvent(e,"loc")}}),1e3),i.monitor(),new Promise(e=>{"complete"===document.readyState?e():window.addEventListener("load",()=>{e()})}).then(()=>{o.recordUserSession()})}({metroplexSocketBase:a(),metroplexHTTPBase:c()})})()})();