define(["jquery","searchSuggested","sweetalert2","oxExclusiveCountdown","productSlider"],function($j,searchSuggested,swal,oxExclusiveCountdown,productSlider){return AmAjax=Class.create(),AmAjax.prototype={options:null,nimiCartClass:"a.top-link-cart",url:null,updateUrl:null,srcImageProgress:null,isProductView:0,typeLoading:0,enMinicart:0,productId:0,top_cart_selector:".header-minicart",initialize:function(e){this.url=e.send_url,this.updateUrl=e.update_url,this.enMinicart=e.enable_minicart,this.typeLoading=e.type_loading,this.options=e,this.srcImageProgress='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80"><path d="M40 72C22.4 72 8 57.6 8 40 8 22.4 22.4 8 40 8c17.6 0 32 14.4 32 32 0 1.1-0.9 2-2 2s-2-0.9-2-2c0-15.4-12.6-28-28-28S12 24.6 12 40s12.6 28 28 28c1.1 0 2 0.9 2 2S41.1 72 40 72z"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 40 40" to="360 40 40" dur="0.8s" repeatCount="indefinite"/></path></svg>',this.isProductView=e.is_product_view,this.currentCategory=e.current_category,this.productId=e.product_id,this.top_cart_selector=".header-minicart",this.nimiCartClass="a.top-link-cart",this.svgArrow='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 477.2 477.2"><path d="M360.7 229.1l-225.1-225.1c-5.3-5.3-13.8-5.3-19.1 0s-5.3 13.8 0 19.1l215.5 215.5 -215.5 215.5c-5.3 5.3-5.3 13.8 0 19.1 2.6 2.6 6.1 4 9.5 4 3.4 0 6.9-1.3 9.5-4l225.1-225.1C365.9 242.9 365.9 234.3 360.7 229.1z"/></svg>',this.isRTL=$j("body").hasClass("rtl")},updateCart:function(){if(Mage.Cookies.set("jarir-logged-user",""),$j(".main-container .block-cart",window.parent.document).length){var e=this.url.replace(this.url.substring(this.url.length-6,this.url.length),"cart");new Ajax.Updater($j(".main-container .block-cart",window.parent.document)[0],e,{method:"post"})}if($j(this.top_cart_selector,window.parent.document).length){e=this.url.replace(this.url.substring(this.url.length-6,this.url.length),"mcart");new Ajax.Request(e,{method:"post",onSuccess:function(e){if(e.responseText){var t=e.responseText;".header-minicart"==this.top_cart_selector?$j(this.top_cart_selector,window.parent.document).html(t):$j(this.top_cart_selector,window.parent.document)[0].outerHTML=t,"1"===AmAjaxObj.enMinicart&&AmAjaxObj.createMinicart(),AmAjaxObj.external()}}.bind(this)})}},updateLinc:function(e){var t=$j(".header__minicart .badge");0<t.length&&t.html(e);var n=$j(".cart-count");0<n.length&&n.html(e);var r=$j(".header__minicart");0<e&&r.removeClass("header__minicart--empty")},updateShoppingCart:function(){if($$("body.checkout-cart-index div.cart")[0]){var e=this.url.replace(this.url.substring(this.url.length-6,this.url.length),"checkout");new Ajax.Request(e,{method:"post",onSuccess:function(e){if(e.responseText){var t=e.responseText,n=document.createElement("div");(n=$(n)).innerHTML=t,$$("body.checkout-cart-index div.cart")[0].innerHTML=n.childElements()[0].innerHTML}}.bind(this)})}},showAnimation:function(e,t){var n=0;if(0!=e&&t&&t.parentNode&&t.parentNode.parentNode&&$$(this.nimiCartClass)[0]){for(var r=0,i=$(t.parentNode);!o&&r<5;){if(i)if((a=i.getElementsByClassName("product-image"))[0])var o=$(a[0]);else{i=$(i.parentNode);r++}}if(o){var a;if((a=o.getElementsByClassName("wrap"))[0])o=$(a[0]);var s=document.createElement("div");(s=$(s)).id="am_loading_container",s.style.position="absolute",s.style.zIndex="99919";var c=o.getElementsByTagName("img");c[0]&&(s.appendChild($(c[0]).cloneNode(!0)),n=1),o.appendChild(s);var d=s.childElements()[0],l=$j(s).offset();if($j(this.nimiCartClass).children().length)var u=$j(this.nimiCartClass).children().first().offset();else u=$j(this.nimiCartClass).offset();$$("body")[0].appendChild(s),s.style.position="absolute",d&&(s.style.top=l.top-2*d.getHeight()+"px"),s.style.left=l.left+"px",s=$(s),new Effect.Shrink(s,{duration:1.5}),new Effect.Fade(s,{duration:1.5}),new Effect.Move(s,{x:u.left,y:u.top,duration:.9,mode:"absolute",afterFinish:function(){$("am_loading_container").remove()}})}}0!=e&&n||$j(function(e){var t=document.createElement("div");(t=e(t)).attr("id","amprogress");var n=document.createElement("div");(n=e(n)).attr("id","amimg_container"),n.appendTo(t);var r=document.createElement("div");(r=e(r)).html(this.srcImageProgress),r.appendTo(n),t.hide().appendTo($j("body",window.parent.document)).fadeIn()}.bind(this))},hideAnimation:function(){$j("#amprogress",window.parent.document).length&&$j(function(e){$j("#amprogress",window.parent.document).fadeOut(function(){e(this).remove()})})},showInlineLoader:function(e){$j(e).addClass("async"),$j(e).prop("disabled",!0)},hideInlineLoader:function(e){$j(e).removeClass("async"),$j(e).prop("disabled",!1)},oneSec:function(){var e=$j("#confirmButtons button:last-child",window.parent.document),t=e.text(),n=parseInt(t.replace(/\D+/g,""));n?(t=t.replace(n,n-1),e.text(t),n<=1&&(clearInterval(document.timer),e.click())):clearInterval(document.timer)},addProductParam:function(t,e){var n=null;if(e){n=$(e).up("form",0);var r=e.getAttribute("data-protection-id");r&&(t+="&protection_service_id="+r)}if($$("#messageBox #product_addtocart_form")[0]&&(n=$$("#messageBox #product_addtocart_form")[0]),n){var i=n.elements.length-1;if(!new Validation(n).validate())return"";var o=$j(n).serialize();""==o&&0<i?$j(n).find("input").each(function(e){t+="&"+e.name+"="}):t+="&"+o}else(n=$("product_addtocart_form-"+t.replace(/[^\d]/gi,"")))&&$("amconf-amcart-"+t.replace(/[^\d]/gi,""))&&(n.hasClassName("isValid")&&(t+="&"+$j(n).serialize()),n.remove());return t+="&IsProductView="+this.isProductView+"&current_category="+this.currentCategory},sendAjax:function sendAjax(idProduct,param,oldEvent,element){if(idProduct){var postData="product_id="+idProduct,qtyField=$j("#qty-"+idProduct);if(null!=qtyField){var qtyValue=qtyField.val();null!=qtyValue&&(postData+="&qty="+qtyValue)}if($j("#amconf-block-"+idProduct).length){var validator=new Validation($("amconf-block-"+idProduct));if(!validator.validate())return"";postData+="&"+$j("#amconf-block-"+idProduct+" :input").serialize()}if(postData=this.addProductParam(postData,element),""==postData)return!0;param&&$j.confirm.hide(),new Ajax.Request(this.url,{method:"post",postBody:postData,onCreate:function(){this.showInlineLoader(element)}.bind(this),onComplete:function(){this.hideInlineLoader(element)}.bind(this),onSuccess:function(transport){if(transport.responseText.isJSON()){var response=transport.responseText.evalJSON();if(response.error)swal({text:response.error,type:"error",confirmButtonText:Translator.translate("Continue")});else{if(response.redirect)return document.all&&!document.querySelector&&(oldEvent=oldEvent.substring(21,oldEvent.length-2)),eval(oldEvent),!0;try{$j.modal.close();var confirmData={title:response.title,message:response.message,header:response.header,side:!0,buttons:{},footer:response.suggested_products,buttons_footer:response.buttons_footer,buttons_top:response.buttons_top};if(response.b1_name&&(confirmData.buttons[1]={name:response.b1_name,class:"button button--primary button--fluid",action:function action(){-1<response.b1_action.indexOf("document.location")&&window.parent.location!=window.location&&(response.b1_action=response.b1_action.replace("document.location","window.parent.location")),eval(response.b1_action)}}),$j.confirm(confirmData),productSlider(".popup-suggested-accessory-slider",!0),productSlider("#wishlist-promo-popup",!0),searchSuggested(),oxExclusiveCountdown(".ox-exclusive-price"),$j("#cross-offers-popup").length){var totalmassspecialoffers=$j("#gift-save-amount").val();$j("#popup-save-amount").html(totalmassspecialoffers)}var maxHeight=.7*$j(window).height(),height=$j("#messageBox").height();maxHeight<height&&$("messageBox").setStyle({overflowY:"scroll",maxHeight:maxHeight+"px"}),"undefined"!=typeof optionsPrice&&(window.currentOptionsPrice=optionsPrice),"undefined"!=typeof opConfig&&(window.currentopConfig=opConfig),"undefined"!=typeof spConfig&&(window.currentspConfig=spConfig),eval(response.script)}catch(e){console.debug(e)}"1"===response.is_add_to_cart&&(this.updateCart(),this.updateShoppingCart(),this.updateMinicart(),this.updateLinc(response.count))}}}.bind(this),onFailure:function(){this.hideInlineLoader(element),eval(oldEvent)}.bind(this)})}},sendSuggestedAjax:function sendSuggestedAjax(element){var oldEvent=element.getAttribute("oldEvent"),url=element.getAttribute("data-url"),id=element.getAttribute("data-id"),qty=element.getAttribute("data-qty"),parentId=element.getAttribute("data-parent");if(id)return url+="isAjax/1",url+="/qty/"+qty,parentId&&(url+="/parent/"+parentId),url=url.replace("checkout/cart/add","amcart/ajax/addCrossOffer"),new Ajax.Request(url,{method:"get",onCreate:function(){this.showInlineLoader(element)}.bind(this),onComplete:function(){this.hideInlineLoader(element)}.bind(this),onSuccess:function(transport){if(transport.responseText.isJSON()){var response=transport.responseText.evalJSON();if(response.error)swal({text:response.error,type:"error",confirmButtonText:Translator.translate("Continue")});else{if(response.redirect)return document.all&&!document.querySelector&&(oldEvent=oldEvent.substring(21,oldEvent.length-2)),eval(oldEvent),!0;"1"===response.is_add_to_cart&&(element.classList.add("btn-suggested--hidden"),this.updateCart(),this.updateShoppingCart(),this.updateMinicart(),this.updateLinc(response.count))}}}.bind(this),onFailure:function(){this.hideInlineLoader(element),eval(oldEvent)}.bind(this)}),!1;document.all&&!document.querySelector&&(oldEvent=oldEvent.substring(21,oldEvent.length-2)),eval(oldEvent)},sendLinkCompareAjax:function sendLinkCompareAjax(idProduct,element){var postData="product_id="+idProduct,url=this.url.replace(this.url.substring(this.url.length-6,this.url.length),"linkcompare");new Ajax.Request(url,{method:"post",postBody:postData,onCreate:function(){this.showInlineLoader(element)}.bind(this),onComplete:function(){this.hideInlineLoader(element)}.bind(this),onSuccess:function(transport){if(transport.responseText.isJSON()){var response=transport.responseText.evalJSON();if(response.error)swal({text:response.error,type:"error",confirmButtonText:Translator.translate("Continue")});else{response.redirect&&eval(response.redirect);try{this.updateCompare()}catch(e){console.debug(e)}}}}.bind(this),onFailure:function(){this.hideInlineLoader(element)}.bind(this)})},updateCompare:function(){var r=$j(".main-container .block-compare");if(0<r.length){var e=this.url.replace(this.url.substring(this.url.length-6,this.url.length),"compare");new Ajax.Request(e,{method:"post",onSuccess:function(e){if(e.responseText){var t=e.responseText;$j(".main-container .block-compare")[0].outerHTML=t,r=$j(".main-container .block-compare");var n=$j(".block-compare__content");0<n.length?n.addClass("block-compare__content--active"):n.removeClass("block-compare__content--active")}}.bind(this)})}},updateWishlist:function(){if(Mage.Cookies.set("jarir-logged-user",""),$j(".main-container .block-wishlist",window.parent.document).length){var e=this.url.replace(this.url.substring(this.url.length-6,this.url.length),"wishlist");new Ajax.Request(e,{method:"post",onSuccess:function(e){if(e.responseText){var t=e.responseText;$j(".main-container .block-wishlist",window.parent.document)[0].outerHTML=t}}.bind(this)})}},sendWishlistAjax:function sendWishlistAjax(idProduct,element){var postData="product_id="+idProduct,url=this.url.replace(this.url.substring(this.url.length-11,this.url.length),"wishlist/add");new Ajax.Request(url,{method:"post",postBody:postData,onCreate:function(){this.showInlineLoader(element)}.bind(this),onComplete:function(){this.hideInlineLoader(element)}.bind(this),onSuccess:function(transport){if(transport.responseText.isJSON()){var response=transport.responseText.evalJSON();if(response.error)swal({text:response.error,type:"error",confirmButtonText:Translator.translate("Continue")});else{response.redirect&&eval(response.redirect);try{$j.confirm({title:response.title,message:response.message,buttons:{1:{name:response.b1_name,class:"button button--primary",action:function action(){eval(response.b1_action)}},2:{name:response.b2_name,class:"button button--standard",action:function action(){-1<response.b2_action.indexOf("document.location")&&window.parent.location!=window.location&&(response.b2_action=response.b2_action.replace("document.location","window.parent.location")),eval(response.b2_action)}}}}),this.updateWishlist()}catch(e){console.debug(e)}}}}.bind(this),onFailure:function(){this.hideInlineLoader(element)}.bind(this)})},createMinicart:function(){var e=$$(this.nimiCartClass)[0];if(e){var t=document.createElement("div");return(t=$(t)).id="am_minicart_container",t.style.display="none",void(e.parentNode&&(e.parentNode.appendChild(t),this.updateMinicart(),Event.observe(t,"mouseover",function(){AmAjaxObj.showMinicart()}),Event.observe(t,"mouseout",function(){AmAjaxObj.hideMinicart()}),Event.observe(e,"mouseover",function(){AmAjaxObj.showMinicart()}),Event.observe(e,"mouseout",function(){AmAjaxObj.hideMinicart()})))}},updateMinicart:function(){var e=AmAjaxObj.url.replace(AmAjaxObj.url.substring(AmAjaxObj.url.length-6,AmAjaxObj.url.length),"minicart"),t=$("am_minicart_container");t&&new Ajax.Updater(t,e,{method:"post"})},showMinicart:function(){$j("#am_minicart_container").stop(!0,!0).delay(300).slideDown(500,"easeOutBounce")},hideMinicart:function(){$j("#am_minicart_container").stop(!0,!0).delay(300).fadeOut(800,"easeInCubic")},getProductId:function(e){var t=e.select("div.price-box [id^=amcart-], div.price-box [id^=product-price-], div.special-price [id^=product-price-], div.price-box [id^=price-excluding-tax-], div.price-box [id^=price-including-tax-], div.price-box [id^=product-minimal-price-], div.price-box [id^=amasty-product-id-], div.price-box [id^=old-price-]");if(!t[0])return!1;var n=t[0].id.match(/\d+/).first();return 0<parseInt(n)&&n<1e7&&parseInt(n)},searchInPriceBox:function(e,t,n){var r=this.getProductId(e);return r&&this.sendAjax(r,"",t,n),r},external:function(){if(require(["CheckoutCrossOffers"],function(e){window.CheckoutCrossOffers=new e}),$j("html").width()<800&&"undefined"!=typeof SmartHeader&&SmartHeader.init(),$j(".skip-cart").length){var e={formKey:AmAjaxObj.options.form_key};new Minicart(e).init()}}},AmAjax});